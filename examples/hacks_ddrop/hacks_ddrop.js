"use strict";!function e(t,n,i){function r(o,s){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n?n:e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){function i(){function e(){r.update(),a.render(o,s),c.update(),requestAnimationFrame(function(){e()})}var t=document.getElementById("r3d");a=new THREE.WebGLRenderer({antialias:!0}),a.setSize(t.offsetWidth,t.offsetHeight),a.setClearColor(16777215,1);var n=a.context.getParameter(a.context.MAX_TEXTURE_SIZE);window.alert("max texture size: "+n);var i=a.context.getParameter(a.context.MAX_TEXTURE_IMAGE_UNITS);window.alert("max texture image units: "+i),t.appendChild(a.domElement),c=new Stats,t.appendChild(c.domElement),o=new THREE.Scene,s=new THREE.PerspectiveCamera(45,t.offsetWidth/t.offsetHeight,1,1e7),s.position.x=100,s.position.y=100,s.position.z=100,s.lookAt(o.position),r=new l(s,a.domElement),e()}var r,a,o,s,c,l=e("../../modules/controls/OrbitControls2D"),u=e("../../modules/loaders/loaders.dicom");window.onload=function(){function e(e){for(var n=0;n<e.target.files.length;n++){var i=e.target.files[n];if(i){var r=new FileReader;r.onload=function(n){var i=n.target.result,r=new u,a=r.parse(i);if(t.push(a),t.length===e.target.files.length){for(var s=[t[0]],c=0;c<t.length;c++)for(var l=0;l<s.length&&!s[l].merge(t[c]);l++)l===s.length-1&&s.push(t[c]);s[0].prepare(),o.add(s[0]);var d=s[0]._series._stack[0],h={lut:"none",luts:["none","spectrum","hotandcold","gold","red","green","blue","grayscale"],grayscale:{label:"Gray Scale",data:[[0,0,0,0],[1,1,1,1]]},spectrum:{label:"Spectrum",data:[[0,0,0,0],[.1,0,0,1],[.33,0,1,1],[.5,0,1,0],[.66,1,1,0],[.9,1,0,0],[1,1,1,1]]},hotandcold:{label:"Hot and cold",data:[[0,0,0,1],[.15,0,1,1],[.3,0,1,0],[.45,0,0,0],[.5,0,0,0],[.55,0,0,0],[.7,1,1,0],[.85,1,0,0],[1,1,1,1]]},gold:{label:"Gold",data:[[0,0,0,0],[.13,.19,.03,0],[.25,.39,.12,0],[.38,.59,.26,0],[.5,.8,.46,.08],[.63,.99,.71,.21],[.75,.99,.88,.34],[.88,.99,.99,.48],[1,.9,.95,.61]]},red:{label:"Red Overlay",data:[[0,.75,0,0],[.5,1,.5,0],[.95,1,1,0],[1,1,1,1]]},green:{label:"Green Overlay",data:[[0,0,.75,0],[.5,.5,1,0],[.95,1,1,0],[1,1,1,1]]},blue:{label:"Blue Overlay",data:[[0,0,0,1],[.5,0,.5,1],[.95,0,1,1],[1,1,1,1]]}},f=new dat.GUI({autoPlace:!1}),p=document.getElementById("my-gui-container");p.appendChild(f.domElement);var m=f.addFolder("Stack"),g=m.add(d,"_windowWidth",1,d._minMax[1]).step(1);g.onChange(function(e){var t=d._windowLevel;t[1]=e,s[0]._uniforms.uWindowLevel.value=t});var y=m.add(d,"_windowCenter",d._minMax[0],d._minMax[1]).step(1);y.onChange(function(e){var t=d._windowLevel;t[0]=e,s[0]._uniforms.uWindowLevel.value=t});var v=m.add(d,"_invert",0,1).step(1);v.onChange(function(e){s[0]._uniforms.uInvert.value=e});var x=m.add(h,"lut",h.luts);x.onChange(function(e){if("none"===e)s[0]._uniforms.uLut.value=0;else{for(var t=new Array(16),n=new Array(16),i=new Array(16),r=new Array(16),a=0;a<h[e].data.length;a++)t[a]=h[e].data[a][0],n[a]=h[e].data[a][1],i[a]=h[e].data[a][2],r[a]=h[e].data[a][3];s[0]._uniforms.uLutI.value=t,s[0]._uniforms.uLutR.value=n,s[0]._uniforms.uLutG.value=i,s[0]._uniforms.uLutB.value=r,s[0]._uniforms.uLut.value=1}});var b=m.add(s[0],"_frameIndex",0,d._dimensions.z-1).step(1);b.onChange(function(e){s[0].updateSliceGeometry(),s[0].updateBorderGeometry()}),m.open()}},r.readAsArrayBuffer(i)}else window.console.log("Failed to load file")}}i();var t=[];document.getElementById("fileinput").addEventListener("change",e,!1)}},{"../../modules/controls/OrbitControls2D":2,"../../modules/loaders/loaders.dicom":6}],2:[function(e,t,n){THREE.OrbitControls2D=function(e,t){function n(){return 2*Math.PI/60/60*p.autoRotateSpeed}function i(){return Math.pow(.95,p.zoomSpeed)}function r(e){if(p.enabled!==!1){if(e.preventDefault(),e.button===p.mouseButtons.ORBIT){if(p.noRotate===!0)return;z=C.ROTATE,g.set(e.clientX,e.clientY)}else if(e.button===p.mouseButtons.ZOOM){if(p.noZoom===!0)return;z=C.DOLLY,E.set(e.clientX,e.clientY)}else if(e.button===p.mouseButtons.PAN){if(p.noPan===!0)return;z=C.PAN,x.set(e.clientX,e.clientY)}z!==C.NONE&&(document.addEventListener("mousemove",a,!1),document.addEventListener("mouseup",o,!1),p.dispatchEvent(F))}}function a(e){if(p.enabled!==!1){e.preventDefault();var t=p.domElement===document?p.domElement.body:p.domElement;if(z===C.ROTATE){if(p.noRotate===!0)return;y.set(e.clientX,e.clientY),v.subVectors(y,g),p.rotateLeft(2*Math.PI*v.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*v.y/t.clientHeight*p.rotateSpeed),g.copy(y)}else if(z===C.DOLLY){if(p.noZoom===!0)return;P.set(e.clientX,e.clientY),T.subVectors(P,E),T.y>0?p.dollyIn():p.dollyOut(),E.copy(P)}else if(z===C.PAN){if(p.noPan===!0)return;b.set(e.clientX,e.clientY),w.subVectors(b,x),p.pan(w.x,w.y),x.copy(b)}z!==C.NONE&&p.update()}}function o(){p.enabled!==!1&&(document.removeEventListener("mousemove",a,!1),document.removeEventListener("mouseup",o,!1),p.dispatchEvent(H),z=C.NONE)}function s(e){if(p.enabled!==!1&&p.noZoom!==!0&&z===C.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?p.dollyOut():p.dollyIn(),p.update(),p.dispatchEvent(F),p.dispatchEvent(H)}}function c(e){if(p.enabled!==!1&&p.noKeys!==!0&&p.noPan!==!0)switch(e.keyCode){case p.keys.UP:p.pan(0,p.keyPanSpeed),p.update();break;case p.keys.BOTTOM:p.pan(0,-p.keyPanSpeed),p.update();break;case p.keys.LEFT:p.pan(p.keyPanSpeed,0),p.update();break;case p.keys.RIGHT:p.pan(-p.keyPanSpeed,0),p.update()}}function l(e){if(p.enabled!==!1){switch(e.touches.length){case 1:if(p.noRotate===!0)return;z=C.TOUCH_ROTATE,g.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(p.noZoom===!0)return;z=C.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);E.set(0,i);break;case 3:if(p.noPan===!0)return;z=C.TOUCH_PAN,x.set(e.touches[0].pageX,e.touches[0].pageY);break;default:z=C.NONE}z!==C.NONE&&p.dispatchEvent(F)}}function u(e){if(p.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=p.domElement===document?p.domElement.body:p.domElement;switch(e.touches.length){case 1:if(p.noRotate===!0)return;if(z!==C.TOUCH_ROTATE)return;y.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(y,g),p.rotateLeft(2*Math.PI*v.x/t.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*v.y/t.clientHeight*p.rotateSpeed),g.copy(y),p.update();break;case 2:if(p.noZoom===!0)return;if(z!==C.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(n*n+i*i);P.set(0,r),T.subVectors(P,E),T.y>0?p.dollyOut():p.dollyIn(),E.copy(P),p.update();break;case 3:if(p.noPan===!0)return;if(z!==C.TOUCH_PAN)return;b.set(e.touches[0].pageX,e.touches[0].pageY),w.subVectors(b,x),p.pan(w.x,w.y),x.copy(b),p.update();break;default:z=C.NONE}}}function d(){p.enabled!==!1&&(p.dispatchEvent(H),z=C.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var h,f,p=this,m=1e-6,g=new THREE.Vector2,y=new THREE.Vector2,v=new THREE.Vector2,x=new THREE.Vector2,b=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector3,S=new THREE.Vector3,E=new THREE.Vector2,P=new THREE.Vector2,T=new THREE.Vector2,D=0,I=0,O=1,M=new THREE.Vector3,A=new THREE.Vector3,R=new THREE.Quaternion,C={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},z=C.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var k=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),L=k.clone().inverse(),B={type:"change"},F={type:"start"},H={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=n()),I-=e},this.rotateUp=function(e){void 0===e&&(e=n()),D-=e},this.panLeft=function(e){var t=this.object.matrix.elements;_.set(t[0],t[1],t[2]),_.multiplyScalar(-e),M.add(_)},this.panUp=function(e){var t=this.object.matrix.elements;_.set(t[4],t[5],t[6]),_.multiplyScalar(e),M.add(_)},this.pan=function(e,t){var n=p.domElement===document?p.domElement.body:p.domElement;if(void 0!==p.object.fov){var i=p.object.position,r=i.clone().sub(p.target),a=r.length();a*=Math.tan(p.object.fov/2*Math.PI/180),p.panLeft(2*e*a/n.clientHeight),p.panUp(2*t*a/n.clientHeight)}else void 0!==p.object.top?(p.panLeft(e*(p.object.right-p.object.left)/(n.clientWidth*this.object.zoom)),p.panUp(t*(p.object.top-p.object.bottom)/(n.clientHeight*this.object.zoom))):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=i()),void 0!==p.object.top?(this.object.zoom*=e,this.object.updateProjectionMatrix()):O/=e},this.dollyOut=function(e){void 0===e&&(e=i()),void 0!==p.object.top?(this.object.zoom/=e,this.object.updateProjectionMatrix()):O*=e},this.update=function(){var e=this.object.position;S.copy(e).sub(this.target),S.applyQuaternion(k),h=Math.atan2(S.x,S.z),f=Math.atan2(Math.sqrt(S.x*S.x+S.z*S.z),S.y),this.autoRotate&&z===C.NONE&&this.rotateLeft(n()),h+=I,f+=D,h=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,h)),f=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,f)),f=Math.max(m,Math.min(Math.PI-m,f));var t=S.length()*O;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(M),S.x=t*Math.sin(f)*Math.sin(h),S.y=t*Math.cos(f),S.z=t*Math.sin(f)*Math.cos(h),S.applyQuaternion(L),e.copy(this.target).add(S),this.object.lookAt(this.target),I=0,D=0,O=1,M.set(0,0,0),(A.distanceToSquared(this.object.position)>m||8*(1-R.dot(this.object.quaternion))>m)&&(this.dispatchEvent(B),A.copy(this.object.position),R.copy(this.object.quaternion))},this.reset=function(){z=C.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.getPolarAngle=function(){return f},this.getAzimuthalAngle=function(){return h},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",u,!1),window.addEventListener("keydown",c,!1),this.update()},THREE.OrbitControls2D.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls2D.prototype.constructor=THREE.OrbitControls2D,t.exports=THREE.OrbitControls2D},{}],3:[function(e,t,n){var i=i||{};i.intersections=i.intersections||{},i.intersections.obbPlane=function(e,t){var n=[],i=t.direction.clone().applyMatrix4(e.toOBBSpace),r=new THREE.Vector3(0,0,0).applyMatrix4(e.toOBBSpace),a={position:t.position.clone().applyMatrix4(e.toOBBSpace),direction:new THREE.Vector3(i.x-r.x,i.y-r.y,i.z-r.z).normalize()},o=new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),s=new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),c={position:new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),direction:e.orientation.x},l=this.rayPlane(c,a);return l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.y,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.z,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c={position:new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z+e.halfDimensions.z),direction:e.orientation.x},l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.y,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.z,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c={position:new THREE.Vector3(e.center.x+e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z-e.halfDimensions.z),direction:e.orientation.y},l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.z,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c={position:new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y+e.halfDimensions.y,e.center.z-e.halfDimensions.z),direction:e.orientation.x},l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.z,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c={position:new THREE.Vector3(e.center.x-e.halfDimensions.x,e.center.y-e.halfDimensions.y,e.center.z+e.halfDimensions.z),direction:e.orientation.x},l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),c.direction=e.orientation.y,l=this.rayPlane(c,a),l&&l.x>=o.x&&l.y>=o.y&&l.z>=o.z&&l.x<=s.x&&l.y<=s.y&&l.z<=s.z&&n.push(l.applyMatrix4(e.toOBBSpaceInvert)),n},i.intersections.rayPlane=function(e,t){if(0!==e.direction.dot(t.direction)){var n=(t.direction.x*(t.position.x-e.position.x)+t.direction.y*(t.position.y-e.position.y)+t.direction.z*(t.position.z-e.position.z))/(t.direction.x*e.direction.x+t.direction.y*e.direction.y+t.direction.z*e.direction.z),i=new THREE.Vector3(e.position.x+n*e.direction.x,e.position.y+n*e.direction.y,e.position.z+n*e.direction.z);return i}return null},t.exports=i.intersections},{}],4:[function(e,t,n){var i=e("../core/Intersections"),r=r||{};r.geometries=r.geometries||{},r.geometries.slice=function(e,t,n,r,a){var o={halfDimensions:e,center:t,orientation:n,toOBBSpace:new THREE.Matrix4,toOBBSpaceInvert:new THREE.Matrix4},s={position:r,direction:a},c=i.obbPlane(o,s);c.length<3&&(window.console.log("WARNING: Less than 3 intersections between OBB and Plane."),window.console.log("OBB"),window.console.log(o),window.console.log("Plane"),window.console.log(s),window.console.log("exiting..."));for(var l=this.centerOfMass(c),u=this.orderIntersections(c,l,a),d=[],h=[],f=0;f<u.length;f++)d.push(u[f].point),h.push(u[f].xy);var p=new THREE.Shape;p.moveTo(h[0].x,h[0].y);for(var m=1;m<h.length;m++)p.lineTo(h[m].x,h[m].y);p.lineTo(h[0].x,h[0].y),THREE.ShapeGeometry.call(this,p),this.type="SliceGeometry",this.vertices=d,this.verticesNeedUpdate=!0},r.geometries.slice.prototype=Object.create(THREE.ShapeGeometry.prototype),r.geometries.slice.prototype.constructor=r.geometries.slice,r.geometries.slice.prototype.centerOfMass=function(e){for(var t=new THREE.Vector3(0,0,0),n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y,t.z+=e[n].z;return t.divideScalar(e.length),t},r.geometries.slice.prototype.orderIntersections=function(e,t,n){for(var i=e[0].x,r=e[0].y,a=e[0].z,o=e[0].x-t.x,s=e[0].y-t.y,c=e[0].z-t.z,l={origin:new THREE.Vector3(i,r,a),direction:new THREE.Vector3(o,s,c).normalize()},u=new THREE.Vector3(0,0,0).crossVectors(l.direction,n).normalize(),d=[],h=0;h<e.length;h++){var f=e[h].x,p=e[h].y,m=e[h].z,g=e[h].x-t.x,y=e[h].y-t.y,v=e[h].z-t.z,x={origin:new THREE.Vector3(f,p,m),direction:new THREE.Vector3(g,y,v).normalize()},b=l.direction.dot(x.direction),w=u.dot(x.direction),_=Math.atan2(w,b),S=_*(180/Math.PI);d.push({angle:S,point:x.origin,xy:{x:b,y:w}})}return d.sort(function(e,t){return e.angle-t.angle}),d},t.exports=r.geometries.slice},{"../core/Intersections":3}],5:[function(e,t,n){var i=e("../geometries/geometries.slice"),r=e("../shaders/shaders.data"),a=a||{};a.helpers=a.helpers||{},a.helpers.series=function(){THREE.Object3D.call(this),this._series=null,this._uniforms=null,this._frameIndex=null,this._slice=null,this._border=null},a.helpers.series.prototype=Object.create(THREE.Object3D.prototype),a.helpers.series.prototype.constructor=a.helpers.series,a.helpers.series.prototype.merge=function(e){return this._series.merge(e._series)},a.helpers.series.prototype.addSeries=function(e){this._series=e},a.helpers.series.prototype.getStack=function(e){return e},a.helpers.series.prototype.prepare=function(){if(window.console.log("helpers Series Prepare!!!"),this._series){var e=this._series._stack[0];e.prepare(),window.console.log(e);var t=e._dimensions,n=e._halfDimensions,a=new THREE.Vector3(-.5,-.5,-.5),o=new THREE.BoxGeometry(t.x,t.y,t.z);o.applyMatrix((new THREE.Matrix4).makeTranslation(n.x+a.x,n.y+a.y,n.z+a.z)),o.applyMatrix(e._ijk2LPS);var s=new THREE.MeshBasicMaterial({wireframe:!0,color:6419187}),c=new THREE.Mesh(o,s);this.add(c);var l=new THREE.Vector3(0,0,0),u=new THREE.Vector3(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)),d=new THREE.Vector3(Math.floor(e._halfDimensions.x),Math.floor(e._halfDimensions.y),Math.floor(e._halfDimensions.z)+.5-e._halfDimensions.z),h=new THREE.Vector3(0,0,1),f=new i(n,l,u,d,h);f.applyMatrix((new THREE.Matrix4).makeTranslation(n.x+a.x,n.y+a.y,n.z+a.z)),f.applyMatrix(e._ijk2LPS),this._frameIndex=Math.round(n.z);for(var p=[],m=0;m<e._nbTextures;m++){var g=new THREE.DataTexture(e._rawData[m],e._textureSize,e._textureSize,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter);g.needsUpdate=!0,p.push(g)}var y=new THREE.ShaderMaterial({side:THREE.DoubleSide,transparency:!0,uniforms:r.parameters.uniforms,vertexShader:"#define GLSLIFY 1\nvarying vec4 vPos;\n\n//\n// main\n//\nvoid main() {\n\n  vPos = modelMatrix * vec4(position, 1.0 );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );\n\n}",fragmentShader:"#define GLSLIFY 1\nuniform float uTextureSize;\nuniform float uWindowLevel[2];\nuniform sampler2D uTextureContainer[7];\nuniform vec3 uDataDimensions;\nuniform mat4 uWorldToData;\nuniform int uNumberOfChannels;\nuniform int uBitsAllocated;\nuniform int uInvert;\n\n// hack because can not pass arrays if too big\n// best would be to pass texture but have to deal with 16bits\nuniform int uLut;\nuniform float uLutI[16]; // 16 * 4 (intesity - r- g - b)\nuniform float uLutR[16];\nuniform float uLutG[16];\nuniform float uLutB[16];\n\nvarying vec4 vPos;\n\nvec4 sampleAs3DTexture(in vec3 textureCoordinate) {\n\n  float slicePixelSize = 1.0 / uTextureSize;\n  // Model coordinate (IJK) to data index\n  float index = textureCoordinate.x * uDataDimensions.x + textureCoordinate.y * uDataDimensions.y * uDataDimensions.x + textureCoordinate.z * uDataDimensions.z * uDataDimensions.y * uDataDimensions.x;\n\n  // Map data index to right sampler2D texture\n  float textureIndex = floor(index / (uTextureSize*uTextureSize));\n  float inTextureIndex = mod(index, uTextureSize*uTextureSize);\n\n  // Get row and column in the texture\n  float rowIndex = floor(inTextureIndex/uTextureSize);\n  float colIndex = mod(inTextureIndex, uTextureSize);\n\n  // Map row and column to uv\n  vec2 uv = vec2(0,0);\n  uv.x = slicePixelSize * 0.5 + colIndex * slicePixelSize;\n  uv.y = 1.0 - (slicePixelSize * 0.5 + rowIndex * slicePixelSize);\n\n  vec4 dataValue = vec4(0, 0, 0, 1);\n  if(textureIndex == 0.0){\n    dataValue = texture2D(uTextureContainer[0], uv);\n  }\n  else if(textureIndex == 1.0){\n    dataValue = texture2D(uTextureContainer[1], uv);\n  }\n  else if(textureIndex == 2.0){\n    dataValue = texture2D(uTextureContainer[2], uv);\n  }\n  else if(textureIndex == 3.0){\n    dataValue = texture2D(uTextureContainer[3], uv);\n  }\n  else if(textureIndex == 4.0){\n    dataValue = texture2D(uTextureContainer[4], uv);\n  }\n  else if(textureIndex == 5.0){\n    dataValue = texture2D(uTextureContainer[5], uv);\n  }\n  else if(textureIndex == 6.0){\n    dataValue = texture2D(uTextureContainer[6], uv);\n  }\n  // else if(textureIndex == 7.0){\n  //   dataValue = texture2D(uTextureContainer[7], uv);\n  // }\n  // else if(textureIndex == 8.0){\n  //   dataValue = texture2D(uTextureContainer[8], uv);\n  // }\n  // else if(textureIndex == 9.0){\n  //   dataValue = texture2D(uTextureContainer[9], uv);\n  // }\n  // else if(textureIndex == 10.0){\n  //   dataValue = texture2D(uTextureContainer[10], uv);\n  // }\n  // else if(textureIndex == 11.0){\n  //   dataValue = texture2D(uTextureContainer[11], uv);\n  // }\n  // else if(textureIndex == 12.0){\n  //   dataValue = texture2D(uTextureContainer[12], uv);\n  // }\n  // else if(textureIndex == 13.0){\n  //   dataValue = texture2D(uTextureContainer[13], uv);\n  // }\n  // else if(textureIndex == 14.0){\n  //   dataValue = texture2D(uTextureContainer[14], uv);\n  // }\n  // else if(textureIndex == 15.0){\n  //   dataValue = texture2D(uTextureContainer[15], uv);\n  // }\n  // else {\n  //   discard;\n  // }\n\n  return dataValue;\n}\n\n\nvoid main(void) {\n\n  // get texture coordinates of current pixel\n  // might not be the right way to do it:\n  // precision issues ar voxels limits\n  // need to add machine epsilon?\n  vec4 dataCoordinateRaw = uWorldToData * vPos;\n  dataCoordinateRaw += 0.5;\n  vec3 dataCoordinate = vec3(floor(dataCoordinateRaw.x), floor(dataCoordinateRaw.y), floor(dataCoordinateRaw.z));\n\n\n  // if data in range, look it up in the texture!\n  if(dataCoordinate.x >= 0.0\n  && dataCoordinate.y >= 0.0\n  && dataCoordinate.z >= 0.0\n  && dataCoordinate.x < uDataDimensions.x\n  && dataCoordinate.y < uDataDimensions.y\n  && dataCoordinate.z < uDataDimensions.z\n  ){\n    vec3 textureCoordinate = dataCoordinate/uDataDimensions;\n    vec4 dataValue = sampleAs3DTexture(textureCoordinate);\n    //vec4(1.0, 0.5, 0.5, 1.0);//\n    \n\n    // Threshold? to copr intensities out?\n\n    if(uNumberOfChannels == 1){\n      // reconstruct 16bits data if any\n      float rawValue = dataValue.r * 255.0 * 256.0 + dataValue.g * 255.0;\n      float windowMin = uWindowLevel[0] - uWindowLevel[1]/2.0;\n      float windowMax = uWindowLevel[0] + uWindowLevel[1]/2.0;\n      float combined = ( rawValue - windowMin ) / uWindowLevel[1];\n\n      dataValue.r = dataValue.g = dataValue.b = combined;\n    }\n\n    // Apply LUT table...\n    // will pass it through a texture...\n\n    if(uLut == 1){\n    // if uApplyLUT\n    // if LUT Gradation? Interpolation\n    // get LUT from texture\n    for(int i=0; i<16; i++){\n      if(dataValue.r < uLutI[i]){\n        // i and i-1\n        float dataValuePosition = dataValue.r - uLutI[i-1];\n        float lutRange = uLutI[i] - uLutI[i-1];\n        float lutWeight = dataValuePosition/lutRange;\n        // use gradation or not??\n        // color distance\n        float colorDistanceR = uLutR[i] - uLutR[i-1];\n        float colorDistanceG = uLutG[i] - uLutG[i-1];\n        float colorDistanceB = uLutB[i] - uLutB[i-1];\n\n        // by weight\n        float colorIncrementR = lutWeight * colorDistanceR;\n        float colorIncrementG = lutWeight * colorDistanceG;\n        float colorIncrementB = lutWeight * colorDistanceB;\n\n        // add it\n        dataValue.r = uLutR[i-1] + colorIncrementR;\n        dataValue.g = uLutG[i-1] + colorIncrementG;\n        dataValue.b = uLutB[i-1] + colorIncrementB;\n        // dataValue.r += colorIncrementR;\n        // dataValue.g += colorIncrementG;\n        // dataValue.b += colorIncrementB;\n       break;\n     }\n    }\n    }\n\n    // Apply label map...?\n    // target specific intensity\n\n    if(uInvert == 1){\n      dataValue = vec4(1, 1, 1, 1) - dataValue;\n      dataValue.a = 1.0;\n    }\n\n    gl_FragColor = dataValue;\n  }\n  else{\n    // should be able to choose what we want to do if not in range:\n    // discard or specific color\n    //discard;\n    gl_FragColor = vec4(0.011, 0.662, 0.956, 1.0);\n  }\n}"}),v=y.clone();this._uniforms=v.uniforms,this._uniforms.uTextureSize.value=e._textureSize,this._uniforms.uTextureContainer.value=p,this._uniforms.uDataDimensions.value=e._dimensions,this._uniforms.uWorldToData.value=e._lps2IJK,this._uniforms.uWindowLevel.value=e._windowLevel,this._uniforms.uNumberOfChannels.value=e._numberOfChannels,this._uniforms.uBitsAllocated.value=e._bitsAllocated,this._uniforms.uInvert.value=e._invert,this._slice=new THREE.Mesh(f,v),this.add(this._slice);for(var x=new THREE.LineBasicMaterial({color:16711680,polygonOffset:!0,polygonOffsetFactor:-.1}),b=new THREE.Geometry,w=0;w<f.vertices.length;w++)b.vertices.push(f.vertices[w]);b.vertices.push(f.vertices[0]),this._border=new THREE.Line(b,x),this.add(this._border)}else window.console.log("no series to be prepared...")},a.helpers.series.prototype.updateSliceGeometry=function(){var e=this._series._stack[0],t=e._halfDimensions,n=new THREE.Vector3(-.5,-.5,-.5),r=new THREE.Vector3(0,0,0),a=new THREE.Vector3(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1)),o=new THREE.Vector3(0,0,this._frameIndex+.5-e._halfDimensions.z),s=new THREE.Vector3(0,0,1),c=new i(t,r,a,o,s);c.applyMatrix((new THREE.Matrix4).makeTranslation(t.x+n.x,t.y+n.y,t.z+n.z)),c.applyMatrix(e._ijk2LPS),this._slice.geometry=c,this._slice.geometry.verticesNeedUpdate=!0},a.helpers.series.prototype.updateBorderGeometry=function(){for(var e=new THREE.Geometry,t=0;t<this._slice.geometry.vertices.length;t++)e.vertices.push(this._slice.geometry.vertices[t]);e.vertices.push(this._slice.geometry.vertices[0]),this._border.geometry.vertices=e.vertices,this._border.geometry.verticesNeedUpdate=!0},t.exports=a.helpers.series},{"../geometries/geometries.slice":4,"../shaders/shaders.data":12}],6:[function(e,t,n){var i=i||{};i.parsers=i.parsers||{},i.parsers.dicom=i.parsers.dicom||e("../parsers/parsers.dicom"),i.models=i.models||{},i.models.series=i.models.series||e("../models/models.series"),i.models.stack=i.models.stack||e("../models/models.stack"),i.models.frame=i.models.frame||e("../models/models.frame"),i.helpers=i.helpers||{},i.helpers.series=i.helpers.series||e("../helpers/helpers.series"),i.loaders=i.loaders||{},i.loaders.dicom=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.crossOrigin=!0,this.responseType="arraybuffer",this._imageHelper=null,this._image=null},i.loaders.dicom.prototype.constructor=i.loaders.dicom,i.loaders.dicom.prototype.load=function(e,t,n,i){var r=this,a=new THREE.XHRLoader(r.manager);a.setCrossOrigin(this.crossOrigin),a.setResponseType(this.responseType),a.load(e,function(e){t(r.parse(e))},n,i)},i.loaders.dicom.prototype.parse=function(e){window.console.log(e),window.console.log("file downloaded yay!");var t=new i.helpers.series,n=new i.parsers.dicom(e,t.id),r=new i.models.series;r._seriesInstanceUID=n.seriesInstanceUID(),r._numberOfFrames=n.numberOfFrames(),r._numberOfFrames||(r._numberOfFrames=1),r._numberOfChannels=n.numberOfChannels();var a=new i.models.stack;a._numberOfChannels=n.numberOfChannels(),r._stack.push(a);for(var o=0;o<r._numberOfFrames;o++){var s=new i.models.frame;s._rows=n.rows(o),s._columns=n.columns(o),s._pixelData=n.extractPixelData(o),s._pixelSpacing=n.pixelSpacing(o),s._sliceThickness=n.sliceThickness(o),s._imageOrientation=n.imageOrientation(o),s._imagePosition=n.imagePosition(o),s._dimensionIndexValues=n.dimensionIndexValues(o),s._bitsAllocated=n.bitsAllocated(o),s._instanceNumber=n.instanceNumber(o),s._minMax=n.minMaxPixelData(s._pixelData),a._frame.push(s)}return t.addSeries(r),t},t.exports=i.loaders.dicom},{"../helpers/helpers.series":5,"../models/models.frame":7,"../models/models.series":8,"../models/models.stack":9,"../parsers/parsers.dicom":11}],7:[function(e,t,n){var i=i||{};i.models=i.models||{},i.models.frame=function(){this._id="-1",this._stackID=-1,this._rows=0,this._columns=0,this._dimensionIndexValues=[],this._imagePositionPatient={x:0,y:0,z:0},this._imageOrientationPatient={row:{x:0,y:0,z:0},column:{x:0,y:0,z:0}},this._sliceThickness=1,this._pixelSpacing={row:1,column:1},this._spacingBetweenSlices=null,this._pixelData=null,this._instanceNumber=null,this._minMax=null},i.models.frame.prototype.constructor=i.models.frame,t.exports=i.models.frame},{}],8:[function(e,t,n){var i=i||{};i.models=i.models||{},i.models.series=function(){this._id=-1,this._concatenationUID=-1,this._seriesInstanceUID=-1,this._seriesNumber=-1,this._dimensionIndexSequence=[],this._rows=0,this._columns=0,this._photometricInterpretation="",this._numberOfFrames=0,this._numberOfChannels=1,this._instanceNumber=0,this._stack=[]},i.models.series.prototype.merge=function(e){var t=!1;if(this._seriesInstanceUID===e._seriesInstanceUID){window.console.log("stacks belong to same series!"),t=!0;for(var n=e._stack,i=0;i<n.length;i++)for(var r=0;r<this._stack.length;r++){if(window.console.log(this._stack[r],n[i]),this._stack[r].merge(n[i])){window.console.log("stacks merged successfully!");break}r===this._stack.length-1&&(window.console.log("stacks added to the list!"),this._stack.push(n[i]))}}return t},t.exports=i.models.series},{}],9:[function(e,t,n){var i=i||{};i.models=i.models||{},i.models.stack=function(){this._id="-1",this._uid=null,this._stackID=-1,this._frame=[],this._rows=0,this._columns=0,this._numberOfFrames=0,this._pixelSpacing={row:0,column:0},this._spacingBetweenSlices=0,this._sliceThickness=0,this._origin=null,this._halfDimensions=null,this._orientation=null,this._textureSize=4096,this._nbTextures=7,this._rawData=[],this._windowLevel=[0,0],this._windowCenter=0,this._windowWidth=0,this._minMax=[65535,-32768],this._invert=0,this._ijk2LPS=null,this._lps2IJK=null,this._dimensions=null,this._spacing=null,this._origin=null,this._direction=null},i.models.stack.prototype.prepare=function(){this._numberOfFrames=this._frame.length,window.console.log(this),this.orderFrames();var e=this.zSpacing();this._frame[0]._pixelSpacing?(this._pixelSpacing.row=this._frame[0]._pixelSpacing[0],this._pixelSpacing.column=this._frame[0]._pixelSpacing[1]):this._frame[0]._pixelAspectRatio?(this._pixelSpacing.row=1,this._pixelSpacing.column=1*this._frame[0]._pixelAspectRatio[1]/this._frame[0]._pixelAspectRatio[0]):(this._pixelSpacing.row=1,this._pixelSpacing.column=1),this._frame[0]._imagePosition||(this._frame[0]._imagePosition=[0,0,0]),this._frame[0]._imageOrientation||(this._frame[0]._imageOrientation=[1,0,0,0,1,0]),this._rows=this._frame[0]._rows,this._columns=this._frame[0]._columns,this._dimensions=new THREE.Vector3(this._columns,this._rows,this._numberOfFrames),this._spacingBetweenSlices=this._frame[0]._spacingBetweenSlices,this._sliceThickness=this._frame[0]._sliceThickness;for(var t=0;t<this._frame.length;t++)this._rows!==this._frame[t]._rows&&(window.console.log("Numbers of rows in stack's frames is not consistent."),window.console.log(this),window.console.log("First frame had: ",this._rows," rows"),window.console.log("Frame index: ",t," has: ",this._frame[t]._rows," rows.")),this._columns!==this._frame[t]._columns&&(window.console.log("Numbers of columns in stack's frames is not consistent."),window.console.log(this),window.console.log("First frame had: ",this._columns," columns."),window.console.log("Frame index: ",t," has: ",this.frame[t]._columns," columns.")),this._minMax[0]=Math.min(this._minMax[0],this._frame[t]._minMax[0]),
this._minMax[1]=Math.max(this._minMax[1],this._frame[t]._minMax[1]);this._origin=new THREE.Vector3(this._frame[0]._imagePosition[0],this._frame[0]._imagePosition[1],this._frame[0]._imagePosition[2]),window.console.log("first frame value!"),window.console.log(this._frame[0]._imageOrientation[0]);var n=new THREE.Vector3(this._frame[0]._imageOrientation[0],this._frame[0]._imageOrientation[1],this._frame[0]._imageOrientation[2]);window.console.log(n);var i=new THREE.Vector3(this._frame[0]._imageOrientation[3],this._frame[0]._imageOrientation[4],this._frame[0]._imageOrientation[5]),r=new THREE.Vector3(0,0,0).crossVectors(n,i).normalize();this._direction=new THREE.Matrix4,this._direction.set(n.x,i.x,r.x,0,n.y,i.y,r.y,0,n.z,i.z,r.z,0,0,0,0,1),window.console.log(this._direction),this._spacing=new THREE.Vector3(this._pixelSpacing.row,this._pixelSpacing.column,e),window.console.log(this._spacing),this._halfDimensions=new THREE.Vector3(this._dimensions.x/2,this._dimensions.y/2,this._dimensions.z/2);var a=new THREE.Vector3(1,0,0),o=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1);this._orientation=new THREE.Vector3(a,o,s),this._ijk2LPS=new THREE.Matrix4,this._ijk2LPS.set(n.x*this._spacing.x,i.x*this._spacing.y,r.x*this._spacing.z,this._origin.x,n.y*this._spacing.x,i.y*this._spacing.y,r.y*this._spacing.z,this._origin.y,n.z*this._spacing.x,i.z*this._spacing.y,r.z*this._spacing.z,this._origin.z,0,0,0,1),this._lps2IJK=new THREE.Matrix4,this._lps2IJK.getInverse(this._ijk2LPS),window.console.log(this._lps2IJK,this._ijk2LPS,this._direction);var c=this._dimensions.x*this._dimensions.y*this._dimensions.z;window.console.log(this._dimensions);for(var l=0;l<this._nbTextures;l++)this._rawData.push(new Uint8Array(this._textureSize*this._textureSize*4));var u=this._dimensions.x*this._dimensions.y,d=this._textureSize*this._textureSize;console.time("arrangeDataForWebgl");for(var h=0;c>h;h++){var f=Math.floor(h/u),p=h%u,m=Math.floor(h/d),g=h%d;if(3===this._numberOfChannels)this._rawData[m][4*g]=this._frame[f]._pixelData[4*p],this._rawData[m][4*g+1]=this._frame[f]._pixelData[4*p+1],this._rawData[m][4*g+2]=this._frame[f]._pixelData[4*p+2],this._rawData[m][4*g+3]=this._frame[f]._pixelData[4*p+3];else{var y=this._frame[f]._pixelData[p],v=255&y,x=y>>8&255;this._rawData[m][4*g]=x,this._rawData[m][4*g+1]=v,this._rawData[m][4*g+2]=f,this._rawData[m][4*g+3]=f}}var b=this._minMax[1]-this._minMax[0],w=this._minMax[0]+b/2;this._windowWidth=b,this._windowCenter=w,this._windowLevel=[w,b],this._bitsAllocated=this._frame[0]._bitsAllocated,window.console.log("window level: ",this._windowLevel)},i.models.stack.prototype.orderFrameOnDimensionIndices=function(e,t){if("_dimensionIndexValues"in e&&"[object Array]"===Object.prototype.toString.call(e._dimensionIndexValues)&&"_dimensionIndexValues"in t&&"[object Array]"===Object.prototype.toString.call(t._dimensionIndexValues))for(var n=0;n<e._dimensionIndexValues.length;n++){if(parseInt(e._dimensionIndexValues[n])>parseInt(t._dimensionIndexValues[n]))return 1;if(parseInt(e._dimensionIndexValues[n])<parseInt(t._dimensionIndexValues[n]))return-1}else window.console.log("One of the frames doesn't have a _dimensionIndexValues array."),window.console.log(e),window.console.log(t);return 0},i.models.stack.prototype.orderFrames=function(){if(window.console.log(this),this._frame[0]._dimensionIndexValues)this._frame.sort(i.models.stack.prototype.orderFrameOnDimensionIndices);else if(this._frame[0]._imagePosition&&this._frame[0]._imageOrientation){var e=new THREE.Vector3(this._frame[0]._imageOrientation[0],this._frame[0]._imageOrientation[1],this._frame[0]._imageOrientation[2]),t=new THREE.Vector3(this._frame[0]._imageOrientation[3],this._frame[0]._imageOrientation[4],this._frame[0]._imageOrientation[5]),n=new THREE.Vector3(0,0,0).crossVectors(e,t).normalize();this._frame.map(this._computeDistance.bind(null,n)),this._frame.sort(this._sortDistance)}},i.models.stack.prototype._computeDistance=function(e,t){return t._dist=t._imagePosition[0]*e.x+t._imagePosition[1]*e.y+t._imagePosition[2]*e.z,t},i.models.stack.prototype._sortDistance=function(e,t){return e._dist-t._dist},i.models.stack.prototype.zSpacing=function(){var e=1;if(window.console.log(this._frame[0]),this._numberOfFrames>1)if(this._spacingBetweenSlices)e=this._spacingBetweenSlices;else if(this._frame[0]._sliceThickness)e=this._frame[0]._sliceThickness;else{var t=new THREE.Vector3(this._frame[0]._imageOrientation[0],this._frame[0]._imageOrientation[1],this._frame[0]._imageOrientation[2]),n=new THREE.Vector3(this._frame[0]._imageOrientation[3],this._frame[0]._imageOrientation[4],this._frame[0]._imageOrientation[5]),i=new THREE.Vector3(0,0,0).crossVectors(t,n).normalize();this._frame.map(this._computeDistance.bind(null,i)),this._frame.sort(this._sortDistance),e=this._frame[1]._dist-this._frame[0]._dist}return 0===e&&(e=1),e},i.models.stack.prototype.merge=function(e){var t=!1;if(this._stackID===e._stackID){t=!0;for(var n=e._frame,i=0;i<n.length;i++)for(var r=0;r<this._frame.length;r++){if(this._frame[r]._dimensionIndexValues&&n[i]._dimensionIndexValues&&this._frame[r]._dimensionIndexValues.join()===n[i]._dimensionIndexValues.join()||this._frame[r]._instanceNumber&&n[i]._instanceNumber&&this._frame[r]._instanceNumber===n[i]._instanceNumber||this._frame[r]._imagePosition&&n[i]._imagePosition&&this._frame[r]._imagePosition.join()===n[i]._imagePosition.join()&&this._frame[r]._imageOrientation&&n[i]._imageOrientation&&this._frame[r]._imageOrientation.join()===n[i]._imageOrientation.join()){window.console.log("BREAKING!"),window.console.log(n[i],this._frame[r]);break}if(r===this._frame.length-1){window.console.log("PUSHING FRAME TO STACK!"),this._frame.push(n[i]);break}}}return window.console.log(this),t},t.exports=i.models.stack},{}],10:[function(e,t,n){function i(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.infos&&console.log("Info: "+e)}function r(e){PDFJS.verbosity>=PDFJS.VERBOSITY_LEVELS.warnings&&console.log("Warning: "+e)}function a(e){if(arguments.length>1){var t=["Error:"];t.push.apply(t,arguments),console.log.apply(console,t),e=[].join.call(arguments," ")}else console.log("Error: "+e);throw console.log(o()),b.notify(x.unknown),new Error(e)}function o(){try{throw new Error}catch(e){return e.stack?e.stack.split("\n").slice(2).join("\n"):""}}function s(e,t){if(!e)return!1;var n=/^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);if(!n)return t;switch(n=n[0].toLowerCase()){case"http":case"https":case"ftp":case"mailto":case"tel":return!0;default:return!1}}function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!1}),n}function l(e){for(var t=1,n=0;e>t;)t<<=1,n++;return n}function u(e,t){return e[t]<<8|e[t+1]}function d(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function h(){var e=new Uint8Array(2);e[0]=1;var t=new Uint16Array(e.buffer);return 1===t[0]}function f(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d"),n=t.createImageData(1,1);return"undefined"!=typeof n.data.buffer}function p(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e}function m(e,t){this.name=e,this.comObj=t,this.callbackIndex=1,this.postMessageTransfers=!0;var n=this.callbacksCapabilities={},i=this.actionHandler={};i.console_log=[function(e){console.log.apply(console,e)}],i.console_error=[function(e){console.error.apply(console,e)}],i._unsupported_feature=[function(e){b.notify(e)}],t.onmessage=function(e){var r=e.data;if(r.isReply){var o=r.callbackId;if(r.callbackId in n){var s=n[o];delete n[o],"error"in r?s.reject(r.error):s.resolve(r.data)}else a("Cannot resolve callback "+o)}else if(r.action in i){var c=i[r.action];r.callbackId?Promise.resolve().then(function(){return c[0].call(c[1],r.data)}).then(function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,data:e})},function(e){t.postMessage({isReply:!0,callbackId:r.callbackId,error:e})}):c[0].call(c[1],r.data)}else a("Unknown action from worker: "+r.action)}}{var g=function(){function e(){this.failOnCorruptedImage=!1}function t(e,t){e.x0=Math.ceil(t.XOsiz/e.XRsiz),e.x1=Math.ceil(t.Xsiz/e.XRsiz),e.y0=Math.ceil(t.YOsiz/e.YRsiz),e.y1=Math.ceil(t.Ysiz/e.YRsiz),e.width=e.x1-e.x0,e.height=e.y1-e.y0}function n(e,t){for(var n,i=e.SIZ,r=[],a=Math.ceil((i.Xsiz-i.XTOsiz)/i.XTsiz),o=Math.ceil((i.Ysiz-i.YTOsiz)/i.YTsiz),s=0;o>s;s++)for(var c=0;a>c;c++)n={},n.tx0=Math.max(i.XTOsiz+c*i.XTsiz,i.XOsiz),n.ty0=Math.max(i.YTOsiz+s*i.YTsiz,i.YOsiz),n.tx1=Math.min(i.XTOsiz+(c+1)*i.XTsiz,i.Xsiz),n.ty1=Math.min(i.YTOsiz+(s+1)*i.YTsiz,i.Ysiz),n.width=n.tx1-n.tx0,n.height=n.ty1-n.ty0,n.components=[],r.push(n);e.tiles=r;for(var l=i.Csiz,u=0,d=l;d>u;u++)for(var h=t[u],f=0,p=r.length;p>f;f++){var m={};n=r[f],m.tcx0=Math.ceil(n.tx0/h.XRsiz),m.tcy0=Math.ceil(n.ty0/h.YRsiz),m.tcx1=Math.ceil(n.tx1/h.XRsiz),m.tcy1=Math.ceil(n.ty1/h.YRsiz),m.width=m.tcx1-m.tcx0,m.height=m.tcy1-m.tcy0,n.components[u]=m}}function a(e,t,n){var i=t.codingStyleParameters,r={};return i.entropyCoderWithCustomPrecincts?(r.PPx=i.precinctsSizes[n].PPx,r.PPy=i.precinctsSizes[n].PPy):(r.PPx=15,r.PPy=15),r.xcb_=n>0?Math.min(i.xcb,r.PPx-1):Math.min(i.xcb,r.PPx),r.ycb_=n>0?Math.min(i.ycb,r.PPy-1):Math.min(i.ycb,r.PPy),r}function o(e,t,n){var i=1<<n.PPx,r=1<<n.PPy,a=0===t.resLevel,o=1<<n.PPx+(a?0:-1),s=1<<n.PPy+(a?0:-1),c=t.trx1>t.trx0?Math.ceil(t.trx1/i)-Math.floor(t.trx0/i):0,l=t.try1>t.try0?Math.ceil(t.try1/r)-Math.floor(t.try0/r):0,u=c*l;t.precinctParameters={precinctWidth:i,precinctHeight:r,numprecinctswide:c,numprecinctshigh:l,numprecincts:u,precinctWidthInSubband:o,precinctHeightInSubband:s}}function s(e,t,n){var i,r,a,o,s=n.xcb_,c=n.ycb_,l=1<<s,u=1<<c,d=t.tbx0>>s,h=t.tby0>>c,f=t.tbx1+l-1>>s,p=t.tby1+u-1>>c,m=t.resolution.precinctParameters,g=[],y=[];for(r=h;p>r;r++)for(i=d;f>i;i++){a={cbx:i,cby:r,tbx0:l*i,tby0:u*r,tbx1:l*(i+1),tby1:u*(r+1)},a.tbx0_=Math.max(t.tbx0,a.tbx0),a.tby0_=Math.max(t.tby0,a.tby0),a.tbx1_=Math.min(t.tbx1,a.tbx1),a.tby1_=Math.min(t.tby1,a.tby1);var v=Math.floor((a.tbx0_-t.tbx0)/m.precinctWidthInSubband),x=Math.floor((a.tby0_-t.tby0)/m.precinctHeightInSubband);if(o=v+x*m.numprecinctswide,a.precinctNumber=o,a.subbandType=t.type,a.Lblock=3,!(a.tbx1_<=a.tbx0_||a.tby1_<=a.tby0_)){g.push(a);var b=y[o];void 0!==b?(i<b.cbxMin?b.cbxMin=i:i>b.cbxMax&&(b.cbxMax=i),r<b.cbyMin?b.cbxMin=r:r>b.cbyMax&&(b.cbyMax=r)):y[o]=b={cbxMin:i,cbyMin:r,cbxMax:i,cbyMax:r},a.precinct=b}}t.codeblockParameters={codeblockWidth:s,codeblockHeight:c,numcodeblockwide:f-d+1,numcodeblockhigh:p-h+1},t.codeblocks=g,t.precincts=y}function c(e,t,n){for(var i=[],r=e.subbands,a=0,o=r.length;o>a;a++)for(var s=r[a],c=s.codeblocks,l=0,u=c.length;u>l;l++){var d=c[l];d.precinctNumber===t&&i.push(d)}return{layerNumber:n,codeblocks:i}}function h(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;a>s;s++)o=Math.max(o,i.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,u=0,d=0,h=0;this.nextPacket=function(){for(;r>l;l++){for(;o>=u;u++){for(;a>d;d++){var e=i.components[d];if(!(u>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[u],n=t.precinctParameters.numprecincts;n>h;){var s=c(t,h,l);return h++,s}h=0}}d=0}u=0}}}function f(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=0,s=0;a>s;s++)o=Math.max(o,i.components[s].codingStyleParameters.decompositionLevelsCount);var l=0,u=0,d=0,h=0;this.nextPacket=function(){for(;o>=l;l++){for(;r>u;u++){for(;a>d;d++){var e=i.components[d];if(!(l>e.codingStyleParameters.decompositionLevelsCount)){for(var t=e.resolutions[l],n=t.precinctParameters.numprecincts;n>h;){var s=c(t,h,u);return h++,s}h=0}}d=0}u=0}}}function p(e){var t,n,i,r,a=e.SIZ,o=e.currentTile.index,s=e.tiles[o],l=s.codingStyleDefaultParameters.layersCount,u=a.Csiz,d=0;for(i=0;u>i;i++){var h=s.components[i];d=Math.max(d,h.codingStyleParameters.decompositionLevelsCount)}var f=new Int32Array(d+1);for(n=0;d>=n;++n){var p=0;for(i=0;u>i;++i){var m=s.components[i].resolutions;n<m.length&&(p=Math.max(p,m[n].precinctParameters.numprecincts))}f[n]=p}t=0,n=0,i=0,r=0,this.nextPacket=function(){for(;d>=n;n++){for(;r<f[n];r++){for(;u>i;i++){var e=s.components[i];if(!(n>e.codingStyleParameters.decompositionLevelsCount)){var a=e.resolutions[n],o=a.precinctParameters.numprecincts;if(!(r>=o)){for(;l>t;){var h=c(a,r,t);return t++,h}t=0}}}i=0}r=0}}}function m(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=x(i),s=o,l=0,u=0,d=0,h=0,f=0;this.nextPacket=function(){for(;f<s.maxNumHigh;f++){for(;h<s.maxNumWide;h++){for(;a>d;d++){for(var e=i.components[d],t=e.codingStyleParameters.decompositionLevelsCount;t>=u;u++){var n=e.resolutions[u],p=o.components[d].resolutions[u],m=v(h,f,p,s,n);if(null!==m){for(;r>l;){var g=c(n,m,l);return l++,g}l=0}}u=0}d=0}h=0}}}function g(e){var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=i.codingStyleDefaultParameters.layersCount,a=t.Csiz,o=x(i),s=0,l=0,u=0,d=0,h=0;this.nextPacket=function(){for(;a>u;++u){for(var e=i.components[u],t=o.components[u],n=e.codingStyleParameters.decompositionLevelsCount;h<t.maxNumHigh;h++){for(;d<t.maxNumWide;d++){for(;n>=l;l++){var f=e.resolutions[l],p=t.resolutions[l],m=v(d,h,p,t,f);if(null!==m){for(;r>s;){var g=c(f,m,s);return s++,g}s=0}}l=0}d=0}h=0}}}function v(e,t,n,i,r){var a=e*i.minWidth,o=t*i.minHeight;if(a%n.width!==0||o%n.height!==0)return null;var s=o/n.width*r.precinctParameters.numprecinctswide;return a/n.height+s}function x(e){for(var t=e.components.length,n=Number.MAX_VALUE,i=Number.MAX_VALUE,r=0,a=0,o=new Array(t),s=0;t>s;s++){for(var c=e.components[s],l=c.codingStyleParameters.decompositionLevelsCount,u=new Array(l+1),d=Number.MAX_VALUE,h=Number.MAX_VALUE,f=0,p=0,m=1,g=l;g>=0;--g){var y=c.resolutions[g],v=m*y.precinctParameters.precinctWidth,x=m*y.precinctParameters.precinctHeight;d=Math.min(d,v),h=Math.min(h,x),f=Math.max(f,y.precinctParameters.numprecinctswide),p=Math.max(p,y.precinctParameters.numprecinctshigh),u[g]={width:v,height:x},m<<=1}n=Math.min(n,d),i=Math.min(i,h),r=Math.max(r,f),a=Math.max(a,p),o[s]={resolutions:u,minWidth:d,minHeight:h,maxNumWide:f,maxNumHigh:p}}return{components:o,minWidth:n,minHeight:i,maxNumWide:r,maxNumHigh:a}}function b(e){for(var t=e.SIZ,n=e.currentTile.index,i=e.tiles[n],r=t.Csiz,c=0;r>c;c++){for(var l=i.components[c],u=l.codingStyleParameters.decompositionLevelsCount,d=[],y=[],v=0;u>=v;v++){var x=a(e,l,v),b={},w=1<<u-v;b.trx0=Math.ceil(l.tcx0/w),b.try0=Math.ceil(l.tcy0/w),b.trx1=Math.ceil(l.tcx1/w),b.try1=Math.ceil(l.tcy1/w),b.resLevel=v,o(e,b,x),d.push(b);var _;if(0===v)_={},_.type="LL",_.tbx0=Math.ceil(l.tcx0/w),_.tby0=Math.ceil(l.tcy0/w),_.tbx1=Math.ceil(l.tcx1/w),_.tby1=Math.ceil(l.tcy1/w),_.resolution=b,s(e,_,x),y.push(_),b.subbands=[_];else{var S=1<<u-v+1,E=[];_={},_.type="HL",_.tbx0=Math.ceil(l.tcx0/S-.5),_.tby0=Math.ceil(l.tcy0/S),_.tbx1=Math.ceil(l.tcx1/S-.5),_.tby1=Math.ceil(l.tcy1/S),_.resolution=b,s(e,_,x),y.push(_),E.push(_),_={},_.type="LH",_.tbx0=Math.ceil(l.tcx0/S),_.tby0=Math.ceil(l.tcy0/S-.5),_.tbx1=Math.ceil(l.tcx1/S),_.tby1=Math.ceil(l.tcy1/S-.5),_.resolution=b,s(e,_,x),y.push(_),E.push(_),_={},_.type="HH",_.tbx0=Math.ceil(l.tcx0/S-.5),_.tby0=Math.ceil(l.tcy0/S-.5),_.tbx1=Math.ceil(l.tcx1/S-.5),_.tby1=Math.ceil(l.tcy1/S-.5),_.resolution=b,s(e,_,x),y.push(_),E.push(_),b.subbands=E}}l.resolutions=d,l.subbands=y}var P=i.codingStyleDefaultParameters.progressionOrder;switch(P){case 0:i.packetsIterator=new h(e);break;case 1:i.packetsIterator=new f(e);break;case 2:i.packetsIterator=new p(e);break;case 3:i.packetsIterator=new m(e);break;case 4:i.packetsIterator=new g(e);break;default:throw new Error("JPX Error: Unsupported progression order "+P)}}function w(e,t,n,i){function r(e){for(;e>h;){var i=t[n+d];d++,f?(u=u<<7|i,h+=7,f=!1):(u=u<<8|i,h+=8),255===i&&(f=!0)}return h-=e,u>>>h&(1<<e)-1}function a(e){return 255===t[n+d-1]&&t[n+d]===e?(o(1),!0):255===t[n+d]&&t[n+d+1]===e?(o(2),!0):!1}function o(e){d+=e}function s(){h=0,f&&(d++,f=!1)}function c(){if(0===r(1))return 1;if(0===r(1))return 2;var e=r(2);return 3>e?e+3:(e=r(5),31>e?e+6:(e=r(7),e+37))}for(var u,d=0,h=0,f=!1,p=e.currentTile.index,m=e.tiles[p],g=e.COD.sopMarkerUsed,y=e.COD.ephMarkerUsed,v=m.packetsIterator;i>d;){s(),g&&a(145)&&o(4);var x=v.nextPacket();if(void 0===x)return;if(r(1)){for(var b,w=x.layerNumber,_=[],S=0,E=x.codeblocks.length;E>S;S++){b=x.codeblocks[S];var P,T=b.precinct,O=b.cbx-T.cbxMin,M=b.cby-T.cbyMin,A=!1,R=!1;if(void 0!==b.included)A=!!r(1);else{T=b.precinct;var C,z;if(void 0!==T.inclusionTree)C=T.inclusionTree;else{var k=T.cbxMax-T.cbxMin+1,L=T.cbyMax-T.cbyMin+1;C=new I(k,L),z=new D(k,L),T.inclusionTree=C,T.zeroBitPlanesTree=z}for(C.reset(O,M,w);;){if(d>=t.length)return;if(C.isAboveThreshold())break;if(C.isKnown())C.nextLevel();else if(r(1)){if(C.setKnown(),C.isLeaf()){b.included=!0,A=R=!0;break}C.nextLevel()}else C.incrementValue()}}if(A){if(R){for(z=T.zeroBitPlanesTree,z.reset(O,M);;){if(d>=t.length)return;if(r(1)){if(P=!z.nextLevel())break}else z.incrementValue()}b.zeroBitPlanes=z.value}for(var B=c();r(1);)b.Lblock++;var F=l(B),H=(1<<F>B?F-1:F)+b.Lblock,U=r(H);_.push({codeblock:b,codingpasses:B,dataLength:U})}}for(s(),y&&a(146);_.length>0;){var V=_.shift();b=V.codeblock,void 0===b.data&&(b.data=[]),b.data.push({data:t,start:n+d,end:n+d+V.dataLength,codingpasses:V.codingpasses}),d+=V.dataLength}}}return d}function _(e,t,n,i,r,a,o,s){for(var c=i.tbx0,l=i.tby0,u=i.tbx1-i.tbx0,d=i.codeblocks,h="H"===i.type.charAt(0)?1:0,f="H"===i.type.charAt(1)?t:0,p=0,m=d.length;m>p;++p){var g=d[p],v=g.tbx1_-g.tbx0_,x=g.tby1_-g.tby0_;if(0!==v&&0!==x&&void 0!==g.data){var b,w;b=new O(v,x,g.subbandType,g.zeroBitPlanes,a),w=2;var _,S,E,P=g.data,T=0,D=0;for(_=0,S=P.length;S>_;_++)E=P[_],T+=E.end-E.start,D+=E.codingpasses;var I=new Int16Array(T),M=0;for(_=0,S=P.length;S>_;_++){E=P[_];var A=E.data.subarray(E.start,E.end);I.set(A,M),M+=A.length}var R=new y(I,0,T);for(b.setDecoder(R),_=0;D>_;_++){switch(w){case 0:b.runSignificancePropogationPass();break;case 1:b.runMagnitudeRefinementPass();break;case 2:b.runCleanupPass(),s&&b.checkSegmentationSymbol()}w=(w+1)%3}var C,z,k,L=g.tbx0_-c+(g.tby0_-l)*u,B=b.coefficentsSign,F=b.coefficentsMagnitude,H=b.bitsDecoded,U=o?0:.5;M=0;var V="LL"!==i.type;for(_=0;x>_;_++){var j=L/u|0,q=2*j*(t-u)+h+f;for(C=0;v>C;C++){if(z=F[M],0!==z){z=(z+U)*r,0!==B[M]&&(z=-z),k=H[M];var N=V?q+(L<<1):L;e[N]=o&&k>=a?z:z*(1<<a-k)}L++,M++}L+=u-v}}}}function S(e,t,n){for(var i=t.components[n],r=i.codingStyleParameters,a=i.quantizationParameters,o=r.decompositionLevelsCount,s=a.SPqcds,c=a.scalarExpounded,l=a.guardBits,u=r.segmentationSymbolUsed,d=e.components[n].precision,h=r.reversibleTransformation,f=h?new R:new A,p=[],m=0,g=0;o>=g;g++){for(var y=i.resolutions[g],v=y.trx1-y.trx0,x=y.try1-y.try0,b=new Float32Array(v*x),w=0,S=y.subbands.length;S>w;w++){var E,P;c?(E=s[m].mu,P=s[m].epsilon,m++):(E=s[0].mu,P=s[0].epsilon+(g>0?1-g:0));var D=y.subbands[w],I=T[D.type],O=h?1:Math.pow(2,d+I-P)*(1+E/2048),M=l+P-1;_(b,v,x,D,O,M,h,u)}p.push({width:v,height:x,items:b})}var C=f.calculate(p,i.tcx0,i.tcy0);return{left:i.tcx0,top:i.tcy0,width:C.width,height:C.height,items:C.items}}function E(e){for(var t=e.SIZ,n=e.components,i=t.Csiz,r=[],a=0,o=e.tiles.length;o>a;a++){var s,c=e.tiles[a],l=[];for(s=0;i>s;s++)l[s]=S(e,c,s);var u=l[0],d=n[0].isSigned;if(d)var h=new Int16Array(u.items.length*i);else var h=new Uint16Array(u.items.length*i);var f,p,m,g,y,v,x,b,w,_,E,P,T,D,I,O={left:u.left,top:u.top,width:u.width,height:u.height,items:h},M=0;if(c.codingStyleDefaultParameters.multipleComponentTransform){var A=4===i,R=l[0].items,C=l[1].items,z=l[2].items,k=A?l[3].items:null;f=n[0].precision-8,p=(128<<f)+.5,m=255*(1<<f),y=.5*m,g=-y;var L=c.components[0],B=i-3;if(x=R.length,L.codingStyleParameters.reversibleTransformation)for(v=0;x>v;v++,M+=B)b=R[v]+p,w=C[v],_=z[v],P=b-(_+w>>2),E=P+_,T=P+w,h[M++]=0>=E?0:E>=m?255:E>>f,h[M++]=0>=P?0:P>=m?255:P>>f,h[M++]=0>=T?0:T>=m?255:T>>f;else for(v=0;x>v;v++,M+=B)b=R[v]+p,w=C[v],_=z[v],E=b+1.402*_,P=b-.34413*w-.71414*_,T=b+1.772*w,h[M++]=0>=E?0:E>=m?255:E>>f,h[M++]=0>=P?0:P>=m?255:P>>f,h[M++]=0>=T?0:T>=m?255:T>>f;if(A)for(v=0,M=3;x>v;v++,M+=4)D=k[v],h[M]=g>=D?0:D>=y?255:D+p>>f}else for(s=0;i>s;s++)if(8===n[s].precision){var F=l[s].items;for(f=n[s].precision-8,p=(128<<f)+.5,m=127.5*(1<<f),g=-m,M=s,v=0,x=F.length;x>v;v++)I=F[v],h[M]=g>=I?0:I>=m?255:I+p>>f,M+=i}else{var d=n[s].isSigned,F=l[s].items;if(d)for(M=s,v=0,x=F.length;x>v;v++)h[M]=F[v],M+=i;else{f=n[s].precision-8,p=(128<<f)+.5;var H=Math.pow(2,n[s].precision)-1;for(M=s,v=0,x=F.length;x>v;v++)I=F[v],h[M]=Math.max(Math.min(I+p,H),0),M+=i}}r.push(O)}return r}function P(e,t){for(var n=e.SIZ,i=n.Csiz,r=e.tiles[t],a=0;i>a;a++){var o=r.components[a],s=void 0!==e.currentTile.QCC[a]?e.currentTile.QCC[a]:e.currentTile.QCD;o.quantizationParameters=s;var c=void 0!==e.currentTile.COC[a]?e.currentTile.COC[a]:e.currentTile.COD;o.codingStyleParameters=c}r.codingStyleDefaultParameters=e.currentTile.COD}var T={LL:0,LH:1,HL:1,HH:2};e.prototype={parse:function(e){var t=u(e,0);if(65359===t)return void this.parseCodestream(e,0,e.length);for(var n=0,a=e.length;a>n;){var o=8,s=d(e,n),c=d(e,n+4);if(n+=o,1===s&&(s=4294967296*d(e,n)+d(e,n+4),n+=8,o+=8),0===s&&(s=a-n+o),o>s)throw new Error("JPX Error: Invalid box field size");var l=s-o,h=!0;switch(c){case 1785737832:h=!1;break;case 1668246642:{var f=e[n];e[n+1],e[n+2]}if(1===f){var p=d(e,n+3);switch(p){case 16:case 17:case 18:break;default:r("Unknown colorspace "+p)}}else 2===f&&i("ICC profile not supported");break;case 1785737827:this.parseCodestream(e,n,n+l);break;case 1783636e3:218793738!==d(e,n)&&r("Invalid JP2 signature");break;case 1783634458:case 1718909296:case 1920099697:case 1919251232:case 1768449138:break;default:var m=String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,255&c);r("Unsupported header type "+c+" ("+m+")")}h&&(n+=l)}},parseImageProperties:function(e){for(var t=e.getByte();t>=0;){var n=t;t=e.getByte();var i=n<<8|t;if(65361===i){e.skip(4);var r=e.getInt32()>>>0,a=e.getInt32()>>>0,o=e.getInt32()>>>0,s=e.getInt32()>>>0;e.skip(16);var c=e.getUint16();return this.width=r-o,this.height=a-s,this.componentsCount=c,void(this.bitsPerComponent=8)}}throw new Error("JPX Error: No size marker found in JPX stream")},parseCodestream:function(e,i,a){var o={};try{for(var s=!1,c=i;a>c+1;){var l=u(e,c);c+=2;var h,f,p,m,g,y,v=0;switch(l){case 65359:o.mainHeader=!0;break;case 65497:break;case 65361:v=u(e,c);var x={};x.Xsiz=d(e,c+4),x.Ysiz=d(e,c+8),x.XOsiz=d(e,c+12),x.YOsiz=d(e,c+16),x.XTsiz=d(e,c+20),x.YTsiz=d(e,c+24),x.XTOsiz=d(e,c+28),x.YTOsiz=d(e,c+32);var _=u(e,c+36);x.Csiz=_;var S=[];h=c+38;for(var T=0;_>T;T++){var D={precision:(127&e[h])+1,isSigned:!!(128&e[h]),XRsiz:e[h+1],YRsiz:e[h+1]};t(D,x),S.push(D)}o.SIZ=x,o.components=S,n(o,S),o.QCC=[],o.COC=[];break;case 65372:v=u(e,c);var I={};switch(h=c+2,f=e[h++],31&f){case 0:m=8,g=!0;break;case 1:m=16,g=!1;break;case 2:m=16,g=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+f)}for(I.noQuantization=8===m,I.scalarExpounded=g,I.guardBits=f>>5,p=[];v+c>h;){var O={};8===m?(O.epsilon=e[h++]>>3,O.mu=0):(O.epsilon=e[h]>>3,O.mu=(7&e[h])<<8|e[h+1],h+=2),p.push(O)}I.SPqcds=p,o.mainHeader?o.QCD=I:(o.currentTile.QCD=I,o.currentTile.QCC=[]);break;case 65373:v=u(e,c);var M={};h=c+2;var A;switch(o.SIZ.Csiz<257?A=e[h++]:(A=u(e,h),h+=2),f=e[h++],31&f){case 0:m=8,g=!0;break;case 1:m=16,g=!1;break;case 2:m=16,g=!0;break;default:throw new Error("JPX Error: Invalid SQcd value "+f)}for(M.noQuantization=8===m,M.scalarExpounded=g,M.guardBits=f>>5,p=[];v+c>h;)O={},8===m?(O.epsilon=e[h++]>>3,O.mu=0):(O.epsilon=e[h]>>3,O.mu=(7&e[h])<<8|e[h+1],h+=2),p.push(O);M.SPqcds=p,o.mainHeader?o.QCC[A]=M:o.currentTile.QCC[A]=M;break;case 65362:v=u(e,c);var R={};h=c+2;var C=e[h++];R.entropyCoderWithCustomPrecincts=!!(1&C),R.sopMarkerUsed=!!(2&C),R.ephMarkerUsed=!!(4&C),R.progressionOrder=e[h++],R.layersCount=u(e,h),h+=2,R.multipleComponentTransform=e[h++],R.decompositionLevelsCount=e[h++],R.xcb=(15&e[h++])+2,R.ycb=(15&e[h++])+2;var z=e[h++];if(R.selectiveArithmeticCodingBypass=!!(1&z),R.resetContextProbabilities=!!(2&z),R.terminationOnEachCodingPass=!!(4&z),R.verticalyStripe=!!(8&z),R.predictableTermination=!!(16&z),R.segmentationSymbolUsed=!!(32&z),R.reversibleTransformation=e[h++],R.entropyCoderWithCustomPrecincts){for(var k=[];v+c>h;){var L=e[h++];k.push({PPx:15&L,PPy:L>>4})}R.precinctsSizes=k}var B=[];if(R.selectiveArithmeticCodingBypass&&B.push("selectiveArithmeticCodingBypass"),R.resetContextProbabilities&&B.push("resetContextProbabilities"),R.terminationOnEachCodingPass&&B.push("terminationOnEachCodingPass"),R.verticalyStripe&&B.push("verticalyStripe"),R.predictableTermination&&B.push("predictableTermination"),B.length>0)throw s=!0,new Error("JPX Error: Unsupported COD options ("+B.join(", ")+")");o.mainHeader?o.COD=R:(o.currentTile.COD=R,o.currentTile.COC=[]);break;case 65424:v=u(e,c),y={},y.index=u(e,c+2),y.length=d(e,c+4),y.dataEnd=y.length+c-2,y.partIndex=e[c+8],y.partsCount=e[c+9],o.mainHeader=!1,0===y.partIndex&&(y.COD=o.COD,y.COC=o.COC.slice(0),y.QCD=o.QCD,y.QCC=o.QCC.slice(0)),o.currentTile=y;break;case 65427:y=o.currentTile,0===y.partIndex&&(P(o,y.index),b(o)),v=y.dataEnd-c,w(o,e,c,v);break;case 65365:case 65367:case 65368:case 65380:v=u(e,c);break;case 65363:throw new Error("JPX Error: Codestream code 0xFF53 (COC) is not implemented");default:throw new Error("JPX Error: Unknown codestream code: "+l.toString(16))}c+=v}}catch(F){if(s||this.failOnCorruptedImage)throw F;r("Trying to recover from "+F.message)}this.tiles=E(o),this.width=o.SIZ.Xsiz-o.SIZ.XOsiz,this.height=o.SIZ.Ysiz-o.SIZ.YOsiz,this.componentsCount=o.SIZ.Csiz}};var D=function(){function e(e,t){var n=l(Math.max(e,t))+1;this.levels=[];for(var i=0;n>i;i++){var r={width:e,height:t,items:[]};this.levels.push(r),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t){for(var n,i=0,r=0;i<this.levels.length;){n=this.levels[i];var a=e+t*n.width;if(void 0!==n.items[a]){r=n.items[a];break}n.index=a,e>>=1,t>>=1,i++}i--,n=this.levels[i],n.items[n.index]=r,this.currentLevel=i,delete this.value},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]++},nextLevel:function(){var e=this.currentLevel,t=this.levels[e],n=t.items[t.index];return e--,0>e?(this.value=n,!1):(this.currentLevel=e,t=this.levels[e],t.items[t.index]=n,!0)}},e}(),I=function(){function e(e,t){var n=l(Math.max(e,t))+1;this.levels=[];for(var i=0;n>i;i++){for(var r=new Uint8Array(e*t),a=new Uint8Array(e*t),o=0,s=r.length;s>o;o++)r[o]=0,a[o]=0;var c={width:e,height:t,items:r,status:a};this.levels.push(c),e=Math.ceil(e/2),t=Math.ceil(t/2)}}return e.prototype={reset:function(e,t,n){this.currentStopValue=n;for(var i=0;i<this.levels.length;){var r=this.levels[i],a=e+t*r.width;r.index=a,e>>=1,t>>=1,i++}this.currentLevel=this.levels.length-1,this.minValue=this.levels[this.currentLevel].items[0]},incrementValue:function(){var e=this.levels[this.currentLevel];e.items[e.index]=e.items[e.index]+1,e.items[e.index]>this.minValue&&(this.minValue=e.items[e.index])},nextLevel:function(){var e=this.currentLevel;if(e--,0>e)return!1;this.currentLevel=e;var t=this.levels[e];return t.items[t.index]<this.minValue?t.items[t.index]=this.minValue:t.items[t.index]>this.minValue&&(this.minValue=t.items[t.index]),!0},isLeaf:function(){return 0===this.currentLevel},isAboveThreshold:function(){var e=this.currentLevel,t=this.levels[e];return t.items[t.index]>this.currentStopValue},isKnown:function(){var e=this.currentLevel,t=this.levels[e];return t.status[t.index]>0},setKnown:function(){var e=this.currentLevel,t=this.levels[e];t.status[t.index]=1}},e}(),O=function(){function e(e,t,n,o,s){this.width=e,this.height=t,this.contextLabelTable="HH"===n?a:"HL"===n?r:i;var c=e*t;this.neighborsSignificance=new Uint8Array(c),this.coefficentsSign=new Uint8Array(c),this.coefficentsMagnitude=s>14?new Uint32Array(c):s>6?new Uint16Array(c):new Uint8Array(c),this.processingFlags=new Uint8Array(c);var l=new Uint8Array(c);if(0!==o)for(var u=0;c>u;u++)l[u]=o;this.bitsDecoded=l,this.reset()}var t=17,n=18,i=new Uint8Array([0,5,8,0,3,7,8,0,4,7,8,0,0,0,0,0,1,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8,0,0,0,0,0,2,6,8,0,3,7,8,0,4,7,8]),r=new Uint8Array([0,3,4,0,5,7,7,0,8,8,8,0,0,0,0,0,1,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8,0,0,0,0,0,2,3,4,0,6,7,7,0,8,8,8]),a=new Uint8Array([0,1,2,0,1,2,2,0,2,2,2,0,0,0,0,0,3,4,5,0,4,5,5,0,5,5,5,0,0,0,0,0,6,7,7,0,7,7,7,0,7,7,7,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8,0,0,0,0,0,8,8,8,0,8,8,8,0,8,8,8]);return e.prototype={setDecoder:function(e){this.decoder=e},reset:function(){this.contexts=new Int8Array(19),this.contexts[0]=8,this.contexts[t]=92,this.contexts[n]=6},setNeighborsSignificance:function(e,t,n){var i,r=this.neighborsSignificance,a=this.width,o=this.height,s=t>0,c=a>t+1;e>0&&(i=n-a,s&&(r[i-1]+=16),c&&(r[i+1]+=16),r[i]+=4),o>e+1&&(i=n+a,s&&(r[i-1]+=16),c&&(r[i+1]+=16),r[i]+=4),s&&(r[n-1]+=1),c&&(r[n+1]+=1),r[n]|=128},runSignificancePropogationPass:function(){for(var e=this.decoder,t=this.width,n=this.height,i=this.coefficentsMagnitude,r=this.coefficentsSign,a=this.neighborsSignificance,o=this.processingFlags,s=this.contexts,c=this.contextLabelTable,l=this.bitsDecoded,u=-2,d=1,h=2,f=0;n>f;f+=4)for(var p=0;t>p;p++)for(var m=f*t+p,g=0;4>g;g++,m+=t){var y=f+g;if(y>=n)break;if(o[m]&=u,!i[m]&&a[m]){var v=c[a[m]],x=e.readBit(s,v);if(x){var b=this.decodeSignBit(y,p,m);r[m]=b,i[m]=1,this.setNeighborsSignificance(y,p,m),o[m]|=h}l[m]++,o[m]|=d}}},decodeSignBit:function(e,t,n){var i,r,a,o,s,c,l=this.width,u=this.height,d=this.coefficentsMagnitude,h=this.coefficentsSign;o=t>0&&0!==d[n-1],l>t+1&&0!==d[n+1]?(a=h[n+1],o?(r=h[n-1],i=1-a-r):i=1-a-a):o?(r=h[n-1],i=1-r-r):i=0;var f=3*i;return o=e>0&&0!==d[n-l],u>e+1&&0!==d[n+l]?(a=h[n+l],o?(r=h[n-l],i=1-a-r+f):i=1-a-a+f):o?(r=h[n-l],i=1-r-r+f):i=f,i>=0?(s=9+i,c=this.decoder.readBit(this.contexts,s)):(s=9-i,c=1^this.decoder.readBit(this.contexts,s)),c},runMagnitudeRefinementPass:function(){for(var e,t=this.decoder,n=this.width,i=this.height,r=this.coefficentsMagnitude,a=this.neighborsSignificance,o=this.contexts,s=this.bitsDecoded,c=this.processingFlags,l=1,u=2,d=n*i,h=4*n,f=0;d>f;f=e){e=Math.min(d,f+h);for(var p=0;n>p;p++)for(var m=f+p;e>m;m+=n)if(r[m]&&0===(c[m]&l)){var g=16;if(0!==(c[m]&u)){c[m]^=u;var y=127&a[m];g=0===y?15:14}var v=t.readBit(o,g);r[m]=r[m]<<1|v,s[m]++,c[m]|=l}}},runCleanupPass:function(){for(var e,i=this.decoder,r=this.width,a=this.height,o=this.neighborsSignificance,s=this.coefficentsMagnitude,c=this.coefficentsSign,l=this.contexts,u=this.contextLabelTable,d=this.bitsDecoded,h=this.processingFlags,f=1,p=2,m=r,g=2*r,y=3*r,v=0;a>v;v=e){e=Math.min(v+4,a);for(var x=v*r,b=a>v+3,w=0;r>w;w++){var _,S=x+w,E=b&&0===h[S]&&0===h[S+m]&&0===h[S+g]&&0===h[S+y]&&0===o[S]&&0===o[S+m]&&0===o[S+g]&&0===o[S+y],P=0,T=S,D=v;if(E){var I=i.readBit(l,n);if(!I){d[S]++,d[S+m]++,d[S+g]++,d[S+y]++;continue}P=i.readBit(l,t)<<1|i.readBit(l,t),0!==P&&(D=v+P,T+=P*r),_=this.decodeSignBit(D,w,T),c[T]=_,s[T]=1,this.setNeighborsSignificance(D,w,T),h[T]|=p,T=S;for(var O=v;D>=O;O++,T+=r)d[T]++;P++}for(D=v+P;e>D;D++,T+=r)if(!s[T]&&0===(h[T]&f)){var M=u[o[T]],A=i.readBit(l,M);1===A&&(_=this.decodeSignBit(D,w,T),c[T]=_,s[T]=1,this.setNeighborsSignificance(D,w,T),h[T]|=p),d[T]++}}}},checkSegmentationSymbol:function(){var e=this.decoder,n=this.contexts,i=e.readBit(n,t)<<3|e.readBit(n,t)<<2|e.readBit(n,t)<<1|e.readBit(n,t);if(10!==i)throw new Error("JPX Error: Invalid segmentation symbol")}},e}(),M=function(){function e(){}return e.prototype.calculate=function(e,t,n){for(var i=e[0],r=1,a=e.length;a>r;r++)i=this.iterate(i,e[r],t,n);return i},e.prototype.extend=function(e,t,n){var i=t-1,r=t+1,a=t+n-2,o=t+n;e[i--]=e[r++],e[o++]=e[a--],e[i--]=e[r++],e[o++]=e[a--],e[i--]=e[r++],e[o++]=e[a--],e[i]=e[r],e[o]=e[a]},e.prototype.iterate=function(e,t,n,i){var r,a,o,s,c,l,u=e.width,d=e.height,h=e.items,f=t.width,p=t.height,m=t.items;

for(o=0,r=0;d>r;r++)for(s=2*r*f,a=0;u>a;a++,o++,s+=2)m[s]=h[o];h=e.items=null;var g=4,y=new Float32Array(f+2*g);if(1===f){if(0!==(1&n))for(l=0,o=0;p>l;l++,o+=f)m[o]*=.5}else for(l=0,o=0;p>l;l++,o+=f)y.set(m.subarray(o,o+f),g),this.extend(y,g,f),this.filter(y,g,f),m.set(y.subarray(g,g+f),o);var v=16,x=[];for(r=0;v>r;r++)x.push(new Float32Array(p+2*g));var b,w=0;if(e=g+p,1===p){if(0!==(1&i))for(c=0;f>c;c++)m[c]*=.5}else for(c=0;f>c;c++){if(0===w){for(v=Math.min(f-c,v),o=c,s=g;e>s;o+=f,s++)for(b=0;v>b;b++)x[b][s]=m[o+b];w=v}w--;var _=x[w];if(this.extend(_,g,p),this.filter(_,g,p),0===w)for(o=c-v+1,s=g;e>s;o+=f,s++)for(b=0;v>b;b++)m[o+b]=x[b][s]}return{width:f,height:p,items:m}},e}(),A=function(){function e(){M.call(this)}return e.prototype=Object.create(M.prototype),e.prototype.filter=function(e,t,n){var i=n>>1;t=0|t;var r,a,o,s,c=-1.586134342059924,l=-.052980118572961,u=.882911075530934,d=.443506852043971,h=1.230174104914001,f=1/h;for(r=t-3,a=i+4;a--;r+=2)e[r]*=f;for(r=t-2,o=d*e[r-1],a=i+3;a--&&(s=d*e[r+1],e[r]=h*e[r]-o-s,a--);r+=2)r+=2,o=d*e[r+1],e[r]=h*e[r]-o-s;for(r=t-1,o=u*e[r-1],a=i+2;a--&&(s=u*e[r+1],e[r]-=o+s,a--);r+=2)r+=2,o=u*e[r+1],e[r]-=o+s;for(r=t,o=l*e[r-1],a=i+1;a--&&(s=l*e[r+1],e[r]-=o+s,a--);r+=2)r+=2,o=l*e[r+1],e[r]-=o+s;if(0!==i)for(r=t+1,o=c*e[r-1],a=i;a--&&(s=c*e[r+1],e[r]-=o+s,a--);r+=2)r+=2,o=c*e[r+1],e[r]-=o+s},e}(),R=function(){function e(){M.call(this)}return e.prototype=Object.create(M.prototype),e.prototype.filter=function(e,t,n){var i=n>>1;t=0|t;var r,a;for(r=t,a=i+1;a--;r+=2)e[r]-=e[r-1]+e[r+1]+2>>2;for(r=t+1,a=i;a--;r+=2)e[r]+=e[r-1]+e[r+1]>>1},e}();return e}(),y=function(){function e(e,t,n){this.data=e,this.bp=t,this.dataEnd=n,this.chigh=e[t],this.clow=0,this.byteIn(),this.chigh=this.chigh<<7&65535|this.clow>>9&127,this.clow=this.clow<<7&65535,this.ct-=7,this.a=32768}var t=[{qe:22017,nmps:1,nlps:1,switchFlag:1},{qe:13313,nmps:2,nlps:6,switchFlag:0},{qe:6145,nmps:3,nlps:9,switchFlag:0},{qe:2753,nmps:4,nlps:12,switchFlag:0},{qe:1313,nmps:5,nlps:29,switchFlag:0},{qe:545,nmps:38,nlps:33,switchFlag:0},{qe:22017,nmps:7,nlps:6,switchFlag:1},{qe:21505,nmps:8,nlps:14,switchFlag:0},{qe:18433,nmps:9,nlps:14,switchFlag:0},{qe:14337,nmps:10,nlps:14,switchFlag:0},{qe:12289,nmps:11,nlps:17,switchFlag:0},{qe:9217,nmps:12,nlps:18,switchFlag:0},{qe:7169,nmps:13,nlps:20,switchFlag:0},{qe:5633,nmps:29,nlps:21,switchFlag:0},{qe:22017,nmps:15,nlps:14,switchFlag:1},{qe:21505,nmps:16,nlps:14,switchFlag:0},{qe:20737,nmps:17,nlps:15,switchFlag:0},{qe:18433,nmps:18,nlps:16,switchFlag:0},{qe:14337,nmps:19,nlps:17,switchFlag:0},{qe:13313,nmps:20,nlps:18,switchFlag:0},{qe:12289,nmps:21,nlps:19,switchFlag:0},{qe:10241,nmps:22,nlps:19,switchFlag:0},{qe:9217,nmps:23,nlps:20,switchFlag:0},{qe:8705,nmps:24,nlps:21,switchFlag:0},{qe:7169,nmps:25,nlps:22,switchFlag:0},{qe:6145,nmps:26,nlps:23,switchFlag:0},{qe:5633,nmps:27,nlps:24,switchFlag:0},{qe:5121,nmps:28,nlps:25,switchFlag:0},{qe:4609,nmps:29,nlps:26,switchFlag:0},{qe:4353,nmps:30,nlps:27,switchFlag:0},{qe:2753,nmps:31,nlps:28,switchFlag:0},{qe:2497,nmps:32,nlps:29,switchFlag:0},{qe:2209,nmps:33,nlps:30,switchFlag:0},{qe:1313,nmps:34,nlps:31,switchFlag:0},{qe:1089,nmps:35,nlps:32,switchFlag:0},{qe:673,nmps:36,nlps:33,switchFlag:0},{qe:545,nmps:37,nlps:34,switchFlag:0},{qe:321,nmps:38,nlps:35,switchFlag:0},{qe:273,nmps:39,nlps:36,switchFlag:0},{qe:133,nmps:40,nlps:37,switchFlag:0},{qe:73,nmps:41,nlps:38,switchFlag:0},{qe:37,nmps:42,nlps:39,switchFlag:0},{qe:21,nmps:43,nlps:40,switchFlag:0},{qe:9,nmps:44,nlps:41,switchFlag:0},{qe:5,nmps:45,nlps:42,switchFlag:0},{qe:1,nmps:45,nlps:43,switchFlag:0},{qe:22017,nmps:46,nlps:46,switchFlag:0}];return e.prototype={byteIn:function(){var e=this.data,t=this.bp;if(255===e[t]){var n=e[t+1];n>143?(this.clow+=65280,this.ct=8):(t++,this.clow+=e[t]<<9,this.ct=7,this.bp=t)}else t++,this.clow+=t<this.dataEnd?e[t]<<8:65280,this.ct=8,this.bp=t;this.clow>65535&&(this.chigh+=this.clow>>16,this.clow&=65535)},readBit:function(e,n){var i,r=e[n]>>1,a=1&e[n],o=t[r],s=o.qe,c=this.a-s;if(this.chigh<s)s>c?(c=s,i=a,r=o.nmps):(c=s,i=1^a,1===o.switchFlag&&(a=i),r=o.nlps);else{if(this.chigh-=s,0!==(32768&c))return this.a=c,a;s>c?(i=1^a,1===o.switchFlag&&(a=i),r=o.nlps):(i=a,r=o.nmps)}do 0===this.ct&&this.byteIn(),c<<=1,this.chigh=this.chigh<<1&65535|this.clow>>15&1,this.clow=this.clow<<1&65535,this.ct--;while(0===(32768&c));return this.a=c,e[n]=r<<1|a,i}},e}(),v="undefined"==typeof window?this:window;"undefined"==typeof window}v.PDFJS||(v.PDFJS={}),v.PDFJS.pdfBug=!1,PDFJS.VERBOSITY_LEVELS={errors:0,warnings:1,infos:5};var x=(PDFJS.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},PDFJS.UNSUPPORTED_FEATURES={unknown:"unknown",forms:"forms",javaScript:"javaScript",smask:"smask",shadingPattern:"shadingPattern",font:"font"}),b=PDFJS.UnsupportedManager=function(){var e=[];return{listen:function(t){e.push(t)},notify:function(t){r('Unsupported feature "'+t+'"');for(var n=0,i=e.length;i>n;n++)e[n](t)}}}();PDFJS.isValidUrl=s,PDFJS.shadow=c;var w=(PDFJS.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},function(){function e(e,t){this.name="PasswordException",this.message=e,this.code=t}return e.prototype=new Error,e.constructor=e,e}());PDFJS.PasswordException=w;var _=function(){function e(e,t){this.name="UnknownErrorException",this.message=e,this.details=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnknownErrorException=_;var S=function(){function e(e){this.name="InvalidPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.InvalidPDFException=S;var E=function(){function e(e){this.name="MissingPDFException",this.message=e}return e.prototype=new Error,e.constructor=e,e}();PDFJS.MissingPDFException=E;var P=function(){function e(e,t){this.name="UnexpectedResponseException",this.message=e,this.status=t}return e.prototype=new Error,e.constructor=e,e}();PDFJS.UnexpectedResponseException=P;!function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="NotImplementedException",e.constructor=e,e}(),function(){function e(e,t){this.begin=e,this.end=t,this.message="Missing data ["+e+", "+t+")"}return e.prototype=new Error,e.prototype.name="MissingDataException",e.constructor=e,e}(),function(){function e(e){this.message=e}return e.prototype=new Error,e.prototype.name="XRefParseException",e.constructor=e,e}();Object.defineProperty(PDFJS,"isLittleEndian",{configurable:!0,get:function(){return c(PDFJS,"isLittleEndian",h())}}),Object.defineProperty(PDFJS,"hasCanvasTypedArrays",{configurable:!0,get:function(){return c(PDFJS,"hasCanvasTypedArrays",f())}});{var T=(function(){function e(e,t){this.buffer=e,this.byteLength=e.length,this.length=void 0===t?this.byteLength>>2:t,n(this.length)}function t(e){return{get:function(){var t=this.buffer,n=e<<2;return(t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24)>>>0},set:function(t){var n=this.buffer,i=e<<2;n[i]=255&t,n[i+1]=t>>8&255,n[i+2]=t>>16&255,n[i+3]=t>>>24&255}}}function n(n){for(;n>i;)Object.defineProperty(e.prototype,i,t(i)),i++}e.prototype=Object.create(null);var i=0;return e}(),PDFJS.Util=function(){function e(){}var t=["rgb(",0,",",0,",",0,")"];return e.makeCssRgb=function(e,n,i){return t[1]=e,t[3]=n,t[5]=i,t.join("")},e.transform=function(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]},e.applyTransform=function(e,t){var n=e[0]*t[0]+e[1]*t[2]+t[4],i=e[0]*t[1]+e[1]*t[3]+t[5];return[n,i]},e.applyInverseTransform=function(e,t){var n=t[0]*t[3]-t[1]*t[2],i=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,r=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[i,r]},e.getAxialAlignedBoundingBox=function(t,n){var i=e.applyTransform(t,n),r=e.applyTransform(t.slice(2,4),n),a=e.applyTransform([t[0],t[3]],n),o=e.applyTransform([t[2],t[1]],n);return[Math.min(i[0],r[0],a[0],o[0]),Math.min(i[1],r[1],a[1],o[1]),Math.max(i[0],r[0],a[0],o[0]),Math.max(i[1],r[1],a[1],o[1])]},e.inverseTransform=function(e){var t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]},e.apply3dTransform=function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]},e.singularValueDecompose2dScale=function(e){var t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],i=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],o=(n+a)/2,s=Math.sqrt((n+a)*(n+a)-4*(n*a-r*i))/2,c=o+s||1,l=o-s||1;return[Math.sqrt(c),Math.sqrt(l)]},e.normalizeRect=function(e){var t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t},e.intersect=function(t,n){function i(e,t){return e-t}var r=[t[0],t[2],n[0],n[2]].sort(i),a=[t[1],t[3],n[1],n[3]].sort(i),o=[];return t=e.normalizeRect(t),n=e.normalizeRect(n),r[0]===t[0]&&r[1]===n[0]||r[0]===n[0]&&r[1]===t[0]?(o[0]=r[1],o[2]=r[2],a[0]===t[1]&&a[1]===n[1]||a[0]===n[1]&&a[1]===t[1]?(o[1]=a[1],o[3]=a[2],o):!1):!1},e.sign=function(e){return 0>e?-1:1},e.appendToArray=function(e,t){Array.prototype.push.apply(e,t)},e.prependToArray=function(e,t){Array.prototype.unshift.apply(e,t)},e.extendObj=function(e,t){for(var n in t)e[n]=t[n]},e.getInheritableProperty=function(e,t){for(;e&&!e.has(t);)e=e.get("Parent");return e?e.get(t):null},e.inherit=function(e,t,n){e.prototype=Object.create(t.prototype),e.prototype.constructor=e;for(var i in n)e.prototype[i]=n[i]},e.loadScript=function(e,t){var n=document.createElement("script"),i=!1;n.setAttribute("src",e),t&&(n.onload=function(){i||t(),i=!0}),document.getElementsByTagName("head")[0].appendChild(n)},e}());PDFJS.PageViewport=function(){function e(e,t,n,i,r,a){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=i,this.offsetY=r;var o,s,c,l,u=(e[2]+e[0])/2,d=(e[3]+e[1])/2;switch(n%=360,n=0>n?n+360:n){case 180:o=-1,s=0,c=0,l=1;break;case 90:o=0,s=1,c=1,l=0;break;case 270:o=0,s=-1,c=-1,l=0;break;default:o=1,s=0,c=0,l=-1}a&&(c=-c,l=-l);var h,f,p,m;0===o?(h=Math.abs(d-e[1])*t+i,f=Math.abs(u-e[0])*t+r,p=Math.abs(e[3]-e[1])*t,m=Math.abs(e[2]-e[0])*t):(h=Math.abs(u-e[0])*t+i,f=Math.abs(d-e[1])*t+r,p=Math.abs(e[2]-e[0])*t,m=Math.abs(e[3]-e[1])*t),this.transform=[o*t,s*t,c*t,l*t,h-o*t*u-c*t*d,f-s*t*u-l*t*d],this.width=p,this.height=m,this.fontScale=t}return e.prototype={clone:function(t){t=t||{};var n="scale"in t?t.scale:this.scale,i="rotation"in t?t.rotation:this.rotation;return new e(this.viewBox.slice(),n,i,this.offsetX,this.offsetY,t.dontFlip)},convertToViewportPoint:function(e,t){return T.applyTransform([e,t],this.transform)},convertToViewportRectangle:function(e){var t=T.applyTransform([e[0],e[1]],this.transform),n=T.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]},convertToPdfPoint:function(e,t){return T.applyInverseTransform([e,t],this.transform)}},e}()}PDFJS.createPromiseCapability=p,function(){function e(e){this._status=t,this._handlers=[];try{e.call(this,this._resolve.bind(this),this._reject.bind(this))}catch(n){this._reject(n)}}if(v.Promise)return"function"!=typeof v.Promise.all&&(v.Promise.all=function(e){var t,n,i=0,r=[],a=new v.Promise(function(e,i){t=e,n=i});return e.forEach(function(e,a){i++,e.then(function(e){r[a]=e,i--,0===i&&t(r)},n)}),0===i&&t(r),a}),"function"!=typeof v.Promise.resolve&&(v.Promise.resolve=function(e){return new v.Promise(function(t){t(e)})}),"function"!=typeof v.Promise.reject&&(v.Promise.reject=function(e){return new v.Promise(function(t,n){n(e)})}),void("function"!=typeof v.Promise.prototype["catch"]&&(v.Promise.prototype["catch"]=function(e){return v.Promise.prototype.then(void 0,e)}));var t=0,n=1,i=2,a=500,o={handlers:[],running:!1,unhandledRejections:[],pendingRejectionCheck:!1,scheduleHandlers:function(e){e._status!==t&&(this.handlers=this.handlers.concat(e._handlers),e._handlers=[],this.running||(this.running=!0,setTimeout(this.runHandlers.bind(this),0)))},runHandlers:function(){for(var e=1,t=Date.now()+e;this.handlers.length>0;){var r=this.handlers.shift(),a=r.thisPromise._status,o=r.thisPromise._value;try{a===n?"function"==typeof r.onResolve&&(o=r.onResolve(o)):"function"==typeof r.onReject&&(o=r.onReject(o),a=n,r.thisPromise._unhandledRejection&&this.removeUnhandeledRejection(r.thisPromise))}catch(s){a=i,o=s}if(r.nextPromise._updateStatus(a,o),Date.now()>=t)break}return this.handlers.length>0?void setTimeout(this.runHandlers.bind(this),0):void(this.running=!1)},addUnhandledRejection:function(e){this.unhandledRejections.push({promise:e,time:Date.now()}),this.scheduleRejectionCheck()},removeUnhandeledRejection:function(e){e._unhandledRejection=!1;for(var t=0;t<this.unhandledRejections.length;t++)this.unhandledRejections[t].promise===e&&(this.unhandledRejections.splice(t),t--)},scheduleRejectionCheck:function(){this.pendingRejectionCheck||(this.pendingRejectionCheck=!0,setTimeout(function(){this.pendingRejectionCheck=!1;for(var e=Date.now(),t=0;t<this.unhandledRejections.length;t++)if(e-this.unhandledRejections[t].time>a){var n=this.unhandledRejections[t].promise._value,i="Unhandled rejection: "+n;n.stack&&(i+="\n"+n.stack),r(i),this.unhandledRejections.splice(t),t--}this.unhandledRejections.length&&this.scheduleRejectionCheck()}.bind(this),a))}};e.all=function(t){function n(e){o._status!==i&&(c=[],a(e))}var r,a,o=new e(function(e,t){r=e,a=t}),s=t.length,c=[];if(0===s)return r(c),o;for(var l=0,u=t.length;u>l;++l){var d=t[l],h=function(e){return function(t){o._status!==i&&(c[e]=t,s--,0===s&&r(c))}}(l);e.isPromise(d)?d.then(h,n):h(d)}return o},e.isPromise=function(e){return e&&"function"==typeof e.then},e.resolve=function(t){return new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.prototype={_status:null,_value:null,_handlers:null,_unhandledRejection:null,_updateStatus:function(t,r){if(this._status!==n&&this._status!==i){if(t===n&&e.isPromise(r))return void r.then(this._updateStatus.bind(this,n),this._updateStatus.bind(this,i));this._status=t,this._value=r,t===i&&0===this._handlers.length&&(this._unhandledRejection=!0,o.addUnhandledRejection(this)),o.scheduleHandlers(this)}},_resolve:function(e){this._updateStatus(n,e)},_reject:function(e){this._updateStatus(i,e)},then:function(t,n){var i=new e(function(e,t){this.resolve=e,this.reject=t});return this._handlers.push({thisPromise:this,onResolve:t,onReject:n,nextPromise:i}),o.scheduleHandlers(this),i},"catch":function(e){return this.then(void 0,e)}},v.Promise=e}();!function(){function e(e,t,n){for(;e.length<n;)e+=t;return e}function t(){this.started={},this.times=[],this.enabled=!0}return t.prototype={time:function(e){this.enabled&&(e in this.started&&r("Timer is already running for "+e),this.started[e]=Date.now())},timeEnd:function(e){this.enabled&&(e in this.started||r("Timer has not been started for "+e),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e])},toString:function(){var t,n,i=this.times,r="",a=0;for(t=0,n=i.length;n>t;++t){var o=i[t].name;o.length>a&&(a=o.length)}for(t=0,n=i.length;n>t;++t){var s=i[t],c=s.end-s.start;r+=e(s.name," ",a)+" "+c+"ms\n"}return r}},t}();PDFJS.createBlob=function(e,t){if("undefined"!=typeof Blob)return new Blob([e],{type:t});var n=new MozBlobBuilder;return n.append(e),n.getBlob(t)},PDFJS.createObjectURL=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return function(t,n){if(!PDFJS.disableCreateObjectURL&&"undefined"!=typeof URL&&URL.createObjectURL){var i=PDFJS.createBlob(t,n);return URL.createObjectURL(i)}for(var r="data:"+n+";base64,",a=0,o=t.length;o>a;a+=3){var s=255&t[a],c=255&t[a+1],l=255&t[a+2],u=s>>2,d=(3&s)<<4|c>>4,h=o>a+1?(15&c)<<2|l>>6:64,f=o>a+2?63&l:64;r+=e[u]+e[d]+e[h]+e[f]}return r}}(),m.prototype={on:function(e,t,n){var i=this.actionHandler;i[e]&&a('There is already an actionName called "'+e+'"'),i[e]=[t,n]},send:function(e,t,n){var i={action:e,data:t};this.postMessage(i,n)},sendWithPromise:function(e,t,n){var i=this.callbackIndex++,r={action:e,data:t,callbackId:i},a=p();this.callbacksCapabilities[i]=a;try{this.postMessage(r,n)}catch(o){a.reject(o)}return a.promise},postMessage:function(e,t){t&&this.postMessageTransfers?this.comObj.postMessage(e,t):this.comObj.postMessage(e)}};var D=typeof t;"undefined"!==D&&t.exports&&(t.exports=g)},{}],11:[function(e,t,n){var i=e("dicom-parser"),r=e("./jpx.js"),a=a||{};a.parsers=a.parsers||{},a.parsers.dicom=function(e,t){this._id=t,this._arrayBuffer=e;var n=new Uint8Array(e);this._dataSet=i.parseDicom(n)},a.parsers.dicom.prototype.seriesInstanceUID=function(){return this._dataSet.string("x0020000e")},a.parsers.dicom.prototype.modality=function(){return this._dataSet.string("x00080060")},a.parsers.dicom.prototype.sopInstanceUID=function(){return this._dataSet.string("x00200018")},a.parsers.dicom.prototype.transferSyntaxUID=function(){return this._dataSet.string("x00020010")},a.parsers.dicom.prototype.photometricInterpretation=function(){return this._dataSet.string("x00280004")},a.parsers.dicom.prototype.planarConfiguration=function(){var e=this._dataSet.uint16("x00280006");return"undefined"==typeof e&&(e=null),e},a.parsers.dicom.prototype.samplesPerPixel=function(){return this._dataSet.uint16("x00280002")},a.parsers.dicom.prototype.numberOfFrames=function(){var e=this._dataSet.intString("x00280008");return"undefined"==typeof e&&(e=null),e},a.parsers.dicom.prototype.numberOfChannels=function(){var e=1,t=this.photometricInterpretation();return("RGB"===t||"PALETTE COLOR"===t||"YBR_FULL"===t||"YBR_FULL_422"===t||"YBR_PARTIAL_422"===t||"YBR_PARTIAL_420"===t||"YBR_RCT"===t)&&(e=3),e},a.parsers.dicom.prototype.imageOrientation=function(e){var t=this._dataSet.string("x00200037");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00209116.items[0].dataSet;t=i.string("x00200037")}else t=null}return t&&(t=t.split("\\").map(Number)),t},a.parsers.dicom.prototype.pixelAspectRatio=function(){var e=[this._dataSet.intString("x00280034",0),this._dataSet.intString("x00280034",1)];return"undefined"==typeof e[0]&&(e=null),e},a.parsers.dicom.prototype.imagePosition=function(e){var t=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00209113.items[0].dataSet;t=i.string("x00200032")}else t=this._dataSet.string("x00200032"),"undefined"==typeof t&&(t=null);return t&&(t=t.split("\\").map(Number)),t},a.parsers.dicom.prototype.instanceNumber=function(e){var t=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n)if(n.items[e].dataSet.elements.x2005140f){var i=n.items[e].dataSet.elements.x2005140f.items[0].dataSet;t=i.intString("x00200013")}else t=this._dataSet.intString("x00200013"),"undefined"==typeof t&&(t=null);else t=this._dataSet.intString("x00200013"),"undefined"==typeof t&&(t=null);return t},a.parsers.dicom.prototype.pixelSpacing=function(e){var t=this._dataSet.string("x00280030");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00289110.items[0].dataSet;t=i.string("x00280030")}else t=null}return t&&(t=t.split("\\").map(Number)),t},a.parsers.dicom.prototype.sopInstanceUID=function(e){var t=this._dataSet.string("x00080018");return t},a.parsers.dicom.prototype.sliceThickness=function(e){var t=this._dataSet.floatString("x00180050");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00289110.items[0].dataSet;t=i.floatString("x00180050")}else t=null}return t},a.parsers.dicom.prototype.rows=function(e){var t=this._dataSet.uint16("x00280010");return"undefined"==typeof t&&(t=null),t},a.parsers.dicom.prototype.columns=function(e){var t=this._dataSet.uint16("x00280011");return"undefined"==typeof t&&(t=null),t},a.parsers.dicom.prototype.pixelRepresentation=function(e){var t=this._dataSet.uint16("x00280103");return t},a.parsers.dicom.prototype.bitsAllocated=function(e){var t=this._dataSet.uint16("x00280100");return t},a.parsers.dicom.prototype.highBit=function(e){var t=this._dataSet.uint16("x00280102");return t},a.parsers.dicom.prototype.rescaleIntercept=function(e){var t=this._dataSet.floatString("x00281052");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00289145.items[0].dataSet;t=i.floatString("x00281052")}else t=null}return t},a.parsers.dicom.prototype.rescaleSlope=function(e){var t=this._dataSet.floatString("x00281053");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00289145.items[0].dataSet;t=i.floatString("x00281052")}else t=null}return t},a.parsers.dicom.prototype.windowCenter=function(e){var t=this._dataSet.floatString("x00281050");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00289132.items[0].dataSet;t=i.floatString("x00281050")}else t=null}return t},a.parsers.dicom.prototype.windowWidth=function(e){var t=this._dataSet.floatString("x00281051");if("undefined"==typeof t){var n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00289132.items[0].dataSet;t=i.floatString("x00281051")}else t=null}return t},a.parsers.dicom.prototype.dimensionIndexValues=function(e){var t=[],n=this._dataSet.elements.x52009230;if("undefined"!=typeof n)for(var i=n.items[e].dataSet.elements.x00209111.items[0].dataSet,r=i.elements.x00209157,a=r.length/4,o=0;a>o;o++)t.push(i.uint32("x00209157",o));else t=null;return t},a.parsers.dicom.prototype.inStackPositionNumber=function(e){var t=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00209111.items[0].dataSet;t=i.uint32("x00209057")}else t=null;return t},a.parsers.dicom.prototype.stackID=function(e){var t=null,n=this._dataSet.elements.x52009230;if("undefined"!=typeof n){var i=n.items[e].dataSet.elements.x00209111.items[0].dataSet;t=i.intString("x00209056")}else t=null;return t},a.parsers.dicom.prototype.decompressPixelData=function(e){var t=[],n=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===n||"1.2.840.10008.1.2.4.91"===n){var a=i.readEncapsulatedPixelData(this._dataSet,this._dataSet.elements.x7fe00010,e),o=new r;o.parse(a);var s=o.componentsCount;if(1!==s)throw"JPEG2000 decoder returned a componentCount of "+s+", when 1 is expected";var c=o.tiles.length;if(1!==c)throw"JPEG2000 decoder returned a tileCount of "+c+", when 1 is expected";var l=o.tiles[0],u=l.items;return u}return t},a.parsers.dicom.prototype.extractPixelData=function(e){var t=null,n=this.transferSyntaxUID();if("1.2.840.10008.1.2.4.90"===n||"1.2.840.10008.1.2.4.91"===n)return this.decompressPixelData(e);var i=this.pixelRepresentation(e),r=this.bitsAllocated(e),a=this._dataSet.elements.x7fe00010,o=a.dataOffset,s=this.numberOfChannels(),c=this.rows(e)*this.columns(e)*s,l=0;if(1===s)0===i&&8===r?(l=o+e*c,t=new Uint8Array(this._dataSet.byteArray.buffer,l,c)):0===i&&16===r?(l=o+e*c*2,t=new Uint16Array(this._dataSet.byteArray.buffer,l,c)):1===i&&16===r&&(l=o+e*c*2,t=new Int16Array(this._dataSet.byteArray.buffer,l,c));else{l=o+e*c;var u=new Uint8Array(this._dataSet.byteArray.buffer,l,c),d=this.photometricInterpretation();if("RGB"===d)t=u;else if("YBR_FULL"===d){t=new Uint8Array(c);for(var h=c/3,f=0,p=0,m=0;h>m;m++){var g=u[f++],y=u[f++],v=u[f++];t[p++]=g+1.402*(v-128),t[p++]=g-.34414*(y-128)-.71414*(v-128),t[p++]=g+1.772*(y-128),t[p++]=255}}else window.console.log("photometric interpolation not supported: "+d)}return t},a.parsers.dicom.prototype.minMaxPixelData=function(e){for(var t=[65535,-32768],n=e.length,i=0;n>i;i++){var r=e[i];t[0]=Math.min(t[0],r),t[1]=Math.max(t[1],r)}return t},t.exports=a.parsers.dicom},{"./jpx.js":10,"dicom-parser":13}],12:[function(e,t,n){var i=i||{};i.shaders=i.shaders||{},i.shaders.data={parameters:{uniforms:{uTextureSize:{type:"f",value:0},uTextureContainer:{type:"tv",value:null},uDataDimensions:{type:"v3",value:new THREE.Vector3},uWorldToData:{type:"m4",value:new THREE.Matrix4},uWindowLevel:{type:"fv1",value:[0,0]},uNumberOfChannels:{type:"i",value:1},uBitsAllocated:{type:"i",value:8},uInvert:{type:"i",value:0},uLut:{type:"i",value:0},uLutI:{type:"fv1",value:[0]},uLutR:{type:"fv1",value:[0]},uLutG:{type:"fv1",value:[0]},uLutB:{type:"fv1",value:[0]}}}},t.exports=i.shaders.data},{}],13:[function(e,t,n){!function(e,n){"undefined"!=typeof t&&t.exports?t.exports=n():"function"==typeof define&&define.amd?define([],n):("undefined"==typeof cornerstone&&(dicomParser={},"undefined"!=typeof Package&&(e.dicomParser=dicomParser)),dicomParser=n())}(this,function(){var e=function(e){return void 0===e&&(e={}),e.parseDicom=function(t,n){function i(){d.seek(128);var e=d.readFixedString(4);if("DICM"!==e)throw"dicomParser.parseDicom: DICM prefix not found at location 132"}function r(){i();for(var t=[],n={};d.position<d.byteArray.length;){var r=d.position,a=e.readDicomElementExplicit(d,t);if(a.tag>"x0002ffff"){d.position=r;break}a.parser=e.littleEndianByteArrayParser,n[a.tag]=a}var o=new e.DataSet(d.byteArrayParser,d.byteArray,n);return o.warnings=d.warnings,o}function a(t){if(void 0===t.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var n=t.elements.x00020010;return e.readFixedString(d.byteArray,n.dataOffset,n.length)}function o(e){return"1.2.840.10008.1.2"===e?!1:!0}function s(n){return"1.2.840.10008.1.2.2"===n?new e.ByteStream(e.bigEndianByteArrayParser,t,d.position):new e.ByteStream(e.littleEndianByteArrayParser,t,d.position)}function c(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}function l(t){var i=a(t),r=o(i),c=s(i),l={},u=new e.DataSet(c.byteArrayParser,c.byteArray,l);u.warnings=c.warnings;try{r?e.parseDicomDataSetExplicit(u,c,c.byteArray.length,n):e.parseDicomDataSetImplicit(u,c,c.byteArray.length,n)}catch(d){var h={exception:d,dataSet:u};throw h}return u}function u(){var e=r(),t=l(e);return c(e,t)}if(void 0===t)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";var d=new e.ByteStream(e.littleEndianByteArrayParser,t);return u()},e}(e),e=function(e){return void 0===e&&(e={}),e.explicitDataSetToJS=function(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var i={};for(var r in t.elements){var a=t.elements[r];if(n.omitPrivateAttibutes!==!0||!e.isPrivateTag(r))if(a.items){for(var o=[],s=0;s<a.items.length;s++)o.push(e.explicitDataSetToJS(a.items[s].dataSet,n));i[r]=o}else{var c;c=void 0,a.length<n.maxElementLength&&(c=e.explicitElementToString(t,a)),i[r]=void 0!==c?c:{dataOffset:a.dataOffset,length:a.length}}}return i},e}(e),e=function(e){return void 0===e&&(e={}),e.explicitElementToString=function(t,n){function i(e,n){for(var i="",r=0;e>r;r++)0!==r&&(i+="/"),i+=n.call(t,o).toString();return i}if(void 0===t||void 0===n)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===n.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var r,a=n.vr,o=n.tag;if(e.isStringVr(a)===!0)r=t.string(o);else{if("AT"==a){var s=t.uint32(o);return void 0===s?void 0:(0>s&&(s=4294967295+s+1),"x"+s.toString(16).toUpperCase())}"US"==a?r=i(n.length/2,t.uint16):"SS"===a?r=i(n.length/2,t.int16):"UL"==a?r=i(n.length/4,t.uint32):"SL"===a?r=i(n.length/4,t.int32):"FD"==a?r=i(n.length/8,t.int32):"FL"==a&&(r=i(n.length/4,t["float"]))}return r},e}(e),e=function(e){void 0===e&&(e={});var t={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return e.isStringVr=function(e){return t[e]},e.isPrivateTag=function(e){var t=parseInt(e[4]),n=t%2===1;return n},e.parsePN=function(e){if(void 0===e)return void 0;var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}},e.parseDA=function(e){if(e&&8===e.length){var t=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),i=parseInt(e.substring(6,8),10);return{year:t,month:n,day:i}}return void 0},e.parseTM=function(e){if(e.length>=2){var t=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,i=e.length>=6?parseInt(e.substring(4,6),10):void 0,r=e.length>=8?parseInt(e.substring(7,13),10):void 0;return{hours:t,minutes:n,seconds:i,fractionalSeconds:r}}return void 0},e}(e),e=function(e){function t(e,t,n){if(1===t.length)return new Uint8Array(e.byteArray.buffer,t[0].dataOffset,t[0].length);for(var i=new Uint8Array(n),r=0,a=0;a<t.length;a++)for(var o=t[a].dataOffset,s=0;s<t[a].length;s++)i[r++]=e.byteArray[o++];return i}function n(n,i){for(var r=[],a=0;n.position<i&&n.position<n.byteArray.length;){var o=e.readSequenceItem(n);if("xfffee0dd"===o.tag)break;r.push(o),n.seek(o.length),a+=o.length}var s=t(n,r,a);return s}function i(e,t,i){var r=e.basicOffsetTable.length;if(i>r)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";var a=e.basicOffsetTable[i];t.seek(a);var o=e.basicOffsetTable[i+1];void 0===o&&(o=t.position+e.length);var s=n(t,o);return s}function r(e,t,i){if(0!==i)throw"dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data";var r=t.position+e.length,a=n(t,r);return a}return void 0===e&&(e={}),e.readEncapsulatedPixelData=function(t,n,a){if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===a)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==n.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(n.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";

if(0>a)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";var o=new e.ByteStream(t.byteArrayParser,t.byteArray,n.dataOffset),s=e.readSequenceItem(o);if("xfffee000"!==s.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";return o.seek(s.length),0!==n.basicOffsetTable.length?i(n,o,a):r(n,o,a)},e}(e),e=function(e){return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3];return n},readInt32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];return n},readFloat:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3];var i=new Float32Array(n.buffer);return i[0]},readDouble:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7];var i=new Float64Array(n.buffer);return i[0]}},e}(e),e=function(e){return void 0===e&&(e={}),e.readFixedString=function(e,t,n){if(0>n)throw"readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var i="",r=0;n>r;r++){var a=e[t+r];if(0===a)return t+=n,i;i+=String.fromCharCode(a)}return i},e}(e),e=function(e){return void 0===e&&(e={}),e.ByteStream=function(e,t,n){if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==!1)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array";if(0>n)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n?n:0,this.warnings=[]},e.ByteStream.prototype.seek=function(e){if(this.position+e<0)throw"cannot seek to position < 0";this.position+=e},e.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"readByteStream - buffer overread";var n=new Uint8Array(this.byteArray.buffer,this.position,t);return this.position+=t,new e.ByteStream(this.byteArrayParser,n)},e.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},e.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},e.ByteStream.prototype.readFixedString=function(t){var n=e.readFixedString(this.byteArray,this.position,t);return this.position+=t,n},e}(e),e=function(e){function t(e,t){return void 0!==e.parser?e.parser:t}return void 0===e&&(e={}),e.DataSet=function(e,t,n){this.byteArrayParser=e,this.byteArray=t,this.elements=n},e.DataSet.prototype.uint16=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readUint16(this.byteArray,i.dataOffset+2*n):void 0},e.DataSet.prototype.int16=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readInt16(this.byteArray,i.dataOffset+2*n):void 0},e.DataSet.prototype.uint32=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readUint32(this.byteArray,i.dataOffset+4*n):void 0},e.DataSet.prototype.int32=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readInt32(this.byteArray,i.dataOffset+4*n):void 0},e.DataSet.prototype["float"]=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readFloat(this.byteArray,i.dataOffset+4*n):void 0},e.DataSet.prototype["double"]=function(e,n){var i=this.elements[e];return n=void 0!==n?n:0,i&&0!==i.length?t(i,this.byteArrayParser).readDouble(this.byteArray,i.dataOffset+8*n):void 0},e.DataSet.prototype.numStringValues=function(t){var n=this.elements[t];if(n&&n.length>0){var i=e.readFixedString(this.byteArray,n.dataOffset,n.length),r=i.match(/\\/g);return null===r?1:r.length+1}return void 0},e.DataSet.prototype.string=function(t,n){var i=this.elements[t];if(i&&i.length>0){var r=e.readFixedString(this.byteArray,i.dataOffset,i.length);if(n>=0){var a=r.split("\\");return a[n].trim()}return r.trim()}return void 0},e.DataSet.prototype.text=function(t,n){var i=this.elements[t];if(i&&i.length>0){var r=e.readFixedString(this.byteArray,i.dataOffset,i.length);if(n>=0){var a=r.split("\\");return a[n].replace(/ +$/,"")}return r.replace(/ +$/,"")}return void 0},e.DataSet.prototype.floatString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var i=this.string(e,t);if(void 0!==i)return parseFloat(i)}return void 0},e.DataSet.prototype.intString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var i=this.string(e,t);if(void 0!==i)return parseInt(i)}return void 0},e}(e),e=function(e){return void 0===e&&(e={}),e.findEndOfEncapsulatedElement=function(t,n,i){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";n.encapsulatedPixelData=!0,n.basicOffsetTable=[],n.fragments=[];var r=e.readTag(t);if("xfffee000"!==r)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var a=t.readUint32(),o=a/4,s=0;o>s;s++){var c=t.readUint32();n.basicOffsetTable.push(c)}for(var l=t.position;t.position<t.byteArray.length;){var u=e.readTag(t),d=t.readUint32();if("xfffee0dd"===u)return t.seek(d),void(n.length=t.position-n.dataOffset);if("xfffee000"!==u)return i&&i.push("unexpected tag "+u+" while searching for end of pixel data element with undefined length"),d>t.byteArray.length-t.position&&(d=t.byteArray.length-t.position),n.fragments.push({offset:t.position-l-8,position:t.position,length:d}),t.seek(d),void(n.length=t.position-n.dataOffset);n.fragments.push({offset:t.position-l-8,position:t.position,length:d}),t.seek(d)}i&&i.push("pixel data element "+n.tag+" missing sequence delimiter tag xfffee0dd")},e}(e),e=function(e){return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=8,i=e.byteArray.length-n;e.position<=i;){var r=e.readUint16();if(65534===r){var a=e.readUint16();if(57357===a){var o=e.readUint32();return 0!==o&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void(t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(e),e=function(e){return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256;return n},readInt32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},readFloat:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3];var i=new Float32Array(n.buffer);return i[0]},readDouble:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7];var i=new Float64Array(n.buffer);return i[0]}},e}(e),e=function(e){return void 0===e&&(e={}),e.parseDicomDataSetExplicit=function(t,n,i,r){if(i=void 0===i?n.byteArray.length:i,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(i<n.position||i>n.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var a=t.elements;n.position<i;){var o=e.readDicomElementExplicit(n,t.warnings,r.untilTag);if(a[o.tag]=o,o.tag===r.untilTag)return}if(n.position>i)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},e.parseDicomDataSetImplicit=function(t,n,i,r){if(i=void 0===i?t.byteArray.length:i,r=r||{},void 0===n)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(i<n.position||i>n.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var a=t.elements;n.position<i;){var o=e.readDicomElementImplicit(n,r.untilTag);if(a[o.tag]=o,o.tag===r.untilTag)return}},e}(e),e=function(e){function t(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}return void 0===e&&(e={}),e.readDicomElementExplicit=function(n,i,r){if(void 0===n)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var a={tag:e.readTag(n),vr:n.readFixedString(2)},o=t(a.vr);return 2===o?(a.length=n.readUint16(),a.dataOffset=n.position):(n.seek(2),a.length=n.readUint32(),a.dataOffset=n.position),4294967295===a.length&&(a.hadUndefinedLength=!0),a.tag===r?a:"SQ"===a.vr?(e.readSequenceItemsExplicit(n,a,i),a):4294967295===a.length?"x7fe00010"===a.tag?(e.findEndOfEncapsulatedElement(n,a,i),a):(e.findItemDelimitationItemAndSetElementLength(n,a),a):(n.seek(a.length),a)},e}(e),e=function(e){return void 0===e&&(e={}),e.readDicomElementImplicit=function(t,n){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var i={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};if(4294967295===i.length&&(i.hadUndefinedLength=!0),i.tag===n)return i;if(t.position+4<=t.byteArray.length){var r=e.readTag(t);if(t.seek(-4),"xfffee000"===r)return e.readSequenceItemsImplicit(t,i),i}return 4294967295===i.length?(e.findItemDelimitationItemAndSetElementLength(t,i),i):(t.seek(i.length),i)},e}(e),e=function(e){function t(t,n){for(var i={};t.position<t.byteArray.length;){var r=e.readDicomElementExplicit(t,n);if(i[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,i)}return t.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,i)}function n(n,i){var r=e.readSequenceItem(n);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=t(n,i),r.length=n.position-r.dataOffset):(r.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetExplicit(r.dataSet,n,n.position+r.length)),r}function i(e,t,i){for(;e.position<e.byteArray.length;){var r=n(e,i);if(t.items.push(r),"xfffee0dd"===r.tag)return void(t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence element of undefined length with tag "+t.tag),t.length=e.byteArray.length-t.dataOffset}function r(e,t,i){for(var r=t.dataOffset+t.length;e.position<r;){var a=n(e,i);t.items.push(a)}}return void 0===e&&(e={}),e.readSequenceItemsExplicit=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?i(e,t):r(e,t,n)},e}(e),e=function(e){function t(t){for(var n={};t.position<t.byteArray.length;){var i=e.readDicomElementImplicit(t);if(n[i.tag]=i,"xfffee00d"===i.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,n)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,n)}function n(n){var i=e.readSequenceItem(n);return 4294967295===i.length?(i.hadUndefinedLength=!0,i.dataSet=t(n),i.length=n.position-i.dataOffset):(i.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetImplicit(i.dataSet,n,n.position+i.length)),i}function i(e,t){for(;e.position<e.byteArray.length;){var i=n(e);if(t.items.push(i),"xfffee0dd"===i.tag)return void(t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}function r(e,t){for(var i=t.dataOffset+t.length;e.position<i;){var r=n(e);t.items.push(r)}}return void 0===e&&(e={}),e.readSequenceItemsImplicit=function(e,t){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?i(e,t):r(e,t)},e}(e),e=function(e){return void 0===e&&(e={}),e.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var n={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};return n},e}(e),e=function(e){return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,n=e.readUint16(),i="x"+("00000000"+(t+n).toString(16)).substr(-8);return i},e}(e);return e})},{}]},{},[1]);
//# sourceMappingURL=../../examples/hacks_ddrop/hacks_ddrop.js.map