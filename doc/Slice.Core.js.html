<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: modules/deprecated/slice/Slice.Core.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"VJS","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">VJS</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="VJS">
            <span class="title">
                <a href="VJS.html">VJS</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.frame">
            <span class="title">
                <a href="VJS.frame.html">VJS.frame</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.image">
            <span class="title">
                <a href="VJS.image.html">VJS.image</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.image.model"><a href="VJS.image.html#model">model</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.slice">
            <span class="title">
                <a href="VJS.slice.html">VJS.slice</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="VJS.slice.shader"><a href="VJS.slice.html#shader">shader</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.stack">
            <span class="title">
                <a href="VJS.stack.html">VJS.stack</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.stack.model"><a href="VJS.stack.html#model">model</a></li>
            
                <li data-name="VJS.stack.view"><a href="VJS.stack.html#view">view</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.volume">
            <span class="title">
                <a href="VJS.volume.html">VJS.volume</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.frame.model">
            <span class="title">
                <a href="VJS.frame.model.html">VJS.frame.model</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.frame.view">
            <span class="title">
                <a href="VJS.frame.view.html">VJS.frame.view</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.slice.core">
            <span class="title">
                <a href="VJS.slice.core.html">VJS.slice.core</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.slice.core#slice"><a href="VJS.slice.core.html#slice">slice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.slice.view">
            <span class="title">
                <a href="VJS.slice.view.html">VJS.slice.view</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.slice.view#RASSlice"><a href="VJS.slice.view.html#RASSlice">RASSlice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.volume.core">
            <span class="title">
                <a href="VJS.volume.core.html">VJS.volume.core</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.volume.core#computeConvenienceVars"><a href="VJS.volume.core.html#computeConvenienceVars">computeConvenienceVars</a></li>
            
                <li data-name="VJS.volume.core#createTexture"><a href="VJS.volume.core.html#createTexture">createTexture</a></li>
            
                <li data-name="VJS.volume.core#getValue"><a href="VJS.volume.core.html#getValue">getValue</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.volume.view">
            <span class="title">
                <a href="VJS.volume.view.html">VJS.volume.view</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="Slice.Core.js.html">Source: modules/deprecated/slice/Slice.Core.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>'use strict';

var VJS = VJS || {};
VJS.slice = VJS.slice || {};

/**
 * @classDesc Core of slice component. Holds all information related to the slice.
 * Provides core slice-related functionnalities.
 *
 * Doesn't deal with the visualization of the volume.
 *
 * @constructor
 * @class
 *
 * @param {Array} origin - sdfsdf
 * @param {Array} normal - sdfsdf
 * @param {VJS.volume.core} volumeCore - sdfsdf
 */
VJS.slice.core = function(origin, normal, volumeCore) {
    this._origin = origin;
    this._normal = normal;
    this._transforms = {};
    this._intersections = [];
    this._intersectionsXY = [];
    this._intersectionsAngle = [];
    this._centerOfMass = null;

    this._volumeCore = volumeCore;
};


/**
 * Compute all required information to generate a slice view.
 *
 * @public
 */
VJS.slice.core.prototype.slice = function() {
    // update all information according to Normal and Origin!   // normalize slice direction
    this._normal.normalize();

    // BENEFITS TO GENERATE THE GEOMETRY BEFORE
    // -MUCH CLEANER
    // - LESS PIXEL TO BE PROCESSED IN SHADERS
    // - REMOVE IF LOOPS IN SHADERS
    // MOREOVER NOT MUCH MORE EXPESIVE THAN PLANE BBOX

    // Should directly get the intersection between OBB and plane
    // need volume 3 directions
    // need volume center RAS
    // need half lenght in each direction
    var obb = {
        'halfDimensions': this._volumeCore._halfDimensions,
        'orientation': this._volumeCore._orientation,
        'center': this._volumeCore._halfDimensions, //this._volumeCore._RAS.center,
        'toOBBSpace': this._volumeCore._transforms.ras2ijk,
        'toOBBSpaceInvert': this._volumeCore._transforms.ijk2ras,
    };

    var plane = {
        'origin': this._origin,
        'normal': this._normal
    };

    // BOOM!
    this._intersections = VJS.Intersections.obbPlane(obb, plane);

    // if less than 3, we have a problem: not a surface!
    if (this._intersections.length &lt; 3) {
        window.console.log('WARNING: Less than 3 intersections between OBB and Plane.');
        window.console.log('OBB');
        window.console.log(obb);
        window.console.log('Plane');
        window.console.log(plane);
        window.console.log('exiting...');
    }

    // center of mass
    this._centerOfMass = new THREE.Vector3(0, 0, 0);
    for (var i = 0; i &lt; this._intersections.length; i++) {
        this._centerOfMass.x += this._intersections[i].x;
        this._centerOfMass.y += this._intersections[i].y;
        this._centerOfMass.z += this._intersections[i].z;
    }
    this._centerOfMass.divideScalar(this._intersections.length);

    // order the intersections
    var epsilon = 0.0000001;
    // reference line
    var a0 = this._intersections[0].x;
    var b0 = this._intersections[0].y;
    var c0 = this._intersections[0].z;
    var x0 = this._intersections[0].x - this._centerOfMass.x;
    var y0 = this._intersections[0].y - this._centerOfMass.y;
    var z0 = this._intersections[0].z - this._centerOfMass.z;
    var l0 = {
        origin: new THREE.Vector3(a0, b0, c0),
        direction: new THREE.Vector3(x0, y0, z0).normalize()
    };

    var base = new THREE.Vector3(0, 0, 0).crossVectors(l0.direction, this._normal).normalize();

    var orderedIntersections = [];

    // other lines // if inter, return location + angle
    for (var j = 0; j &lt; this._intersections.length; j++) {

        var a1 = this._intersections[j].x;
        var b1 = this._intersections[j].y;
        var c1 = this._intersections[j].z;
        var x1 = this._intersections[j].x - this._centerOfMass.x;
        var y1 = this._intersections[j].y - this._centerOfMass.y;
        var z1 = this._intersections[j].z - this._centerOfMass.z;

        var l1 = {
            origin: new THREE.Vector3(a1, b1, c1),
            direction: new THREE.Vector3(x1, y1, z1).normalize()
        };

        // if lines intersect, proceed
        // http://www.nabla.hr/PC-LinePlaneIn3DSp2.htm
        var intersect = -1;

        var origs = new THREE.Vector3(0, 0, 0).subVectors(l0.origin, l1.origin).normalize();
        intersect = origs.dot(this._normal);

        if (Math.abs(intersect) &lt; epsilon) {
            var x = l0.direction.dot(l1.direction);
            var y = base.dot(l1.direction);

            var thetaAngle = Math.atan2(y, x);
            var theta = thetaAngle * (180 / Math.PI);
            orderedIntersections.push({
                'angle': theta,
                'point': l1.origin,
                'xy': {
                    'x': x,
                    'y': y
                }
            });

        } else {
            window.console.log('no intersection...!');
        }
    }

    orderedIntersections.sort(function(a, b) {
        return a.angle - b.angle;
    });

    // format vars
    this._intersections = [];
    for (var k = 0; k &lt; orderedIntersections.length; k++) {
        this._intersections.push(orderedIntersections[k].point);
        this._intersectionsXY.push(orderedIntersections[k].xy);
        this._intersectionsAngle.push(orderedIntersections[k].angle);
    }
};
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Wed May 13 2015 09:02:24 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
