<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: modules/deprecated/slice/Slice.Shader.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"VJS","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">VJS</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="VJS">
            <span class="title">
                <a href="VJS.html">VJS</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.frame">
            <span class="title">
                <a href="VJS.frame.html">VJS.frame</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.image">
            <span class="title">
                <a href="VJS.image.html">VJS.image</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.image.model"><a href="VJS.image.html#model">model</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.slice">
            <span class="title">
                <a href="VJS.slice.html">VJS.slice</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="VJS.slice.shader"><a href="VJS.slice.html#shader">shader</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.stack">
            <span class="title">
                <a href="VJS.stack.html">VJS.stack</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.stack.model"><a href="VJS.stack.html#model">model</a></li>
            
                <li data-name="VJS.stack.view"><a href="VJS.stack.html#view">view</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.volume">
            <span class="title">
                <a href="VJS.volume.html">VJS.volume</a>
                
                <span class="static">static</span>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.frame.model">
            <span class="title">
                <a href="VJS.frame.model.html">VJS.frame.model</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.frame.view">
            <span class="title">
                <a href="VJS.frame.view.html">VJS.frame.view</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.slice.core">
            <span class="title">
                <a href="VJS.slice.core.html">VJS.slice.core</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.slice.core#slice"><a href="VJS.slice.core.html#slice">slice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.slice.view">
            <span class="title">
                <a href="VJS.slice.view.html">VJS.slice.view</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.slice.view#RASSlice"><a href="VJS.slice.view.html#RASSlice">RASSlice</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.volume.core">
            <span class="title">
                <a href="VJS.volume.core.html">VJS.volume.core</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="VJS.volume.core#computeConvenienceVars"><a href="VJS.volume.core.html#computeConvenienceVars">computeConvenienceVars</a></li>
            
                <li data-name="VJS.volume.core#createTexture"><a href="VJS.volume.core.html#createTexture">createTexture</a></li>
            
                <li data-name="VJS.volume.core#getValue"><a href="VJS.volume.core.html#getValue">getValue</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="VJS.volume.view">
            <span class="title">
                <a href="VJS.volume.view.html">VJS.volume.view</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="Slice.Shader.js.html">Source: modules/deprecated/slice/Slice.Shader.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>'use strict';

var VJS = VJS || {};
VJS.slice = VJS.slice || {};

/**
 *
 * Custom shader for the slice object. Should be a shader directory. We can add this shader to any object...
 * @member
 *
 */

VJS.slice.shader = {

    /* -------------------------------------------------------------------------
    //  Slice shader
    // features:
    //
     ------------------------------------------------------------------------- */

    'slice': {

        uniforms: {
            // texture specific
            'uTextureSize': {
                type: 'f',
                value: 0.0
            },
            't00': {
                type: 't',
                value: null
            },
            't01': {
                type: 't',
                value: null
            },
            't02': {
                type: 't',
                value: null
            },
            't03': {
                type: 't',
                value: null
            },

            // image specific
            'uIJKDims': {
                type: 'v3',
                value: new THREE.Vector3()
            },
            'uRASToIJK': {
                type: 'm4',
                value: new THREE.Matrix4()
            }
        },

        fragmentShader: [
            //
            // Get pixel color given IJK coordinate and texture
            //
            'vec4 getIJKValue( sampler2D tex0, sampler2D tex1, sampler2D tex2, sampler2D tex3, vec3 ijkCoordinates, vec3 ijkDimensions, float uTextureSize) {',
            // IJK coord to texture
            'highp float index = ijkCoordinates[0] + ijkCoordinates[1]*ijkDimensions[0] + ijkCoordinates[2]*ijkDimensions[0]*ijkDimensions[1];',

            // map index to right sampler2D slice
            'highp float sliceIndex = floor(index / (uTextureSize*uTextureSize));',
            'highp float inTextureIndex = mod(index, uTextureSize*uTextureSize);',

            // get row in the texture
            'highp float rowIndex = floor(inTextureIndex/uTextureSize);',
            'highp float colIndex = mod(inTextureIndex, uTextureSize);',

            // map to uv
            'vec2 sliceSize = vec2(1.0 / uTextureSize, 1.0 / uTextureSize);',
            'highp float u = colIndex*sliceSize.x + sliceSize.x/2.;',
            'highp float v = 1.0 - (rowIndex*sliceSize.y + sliceSize.y/2.);',

            'highp vec2 uv = vec2(u,v);',
            'vec4 ijkValue = vec4(0, 0, 0, 0);',
            'if(sliceIndex == float(0)){',
            'ijkValue = texture2D(tex0, uv);',
            '}',
            'else if(sliceIndex == float(1)){',
            'ijkValue = texture2D(tex1, uv);',
            '}',
            'else if(sliceIndex == float(2)){',
            'ijkValue = texture2D(tex2, uv);',
            '}',
            'else if(sliceIndex == float(3)){',
            'ijkValue = texture2D(tex3, uv);',
            '}',

            'return ijkValue;',
            '}',


            'precision highp float;',
            'precision highp sampler2D;',

            'uniform float uTextureSize;',
            'uniform sampler2D t00;',
            'uniform sampler2D t01;',
            'uniform sampler2D t02;',
            'uniform sampler2D t03;',

            'uniform vec3 uIJKDims;',
            'uniform mat4 uRASToIJK;',


            'varying vec4 vPos;',

            'void main(void) {',

            // get IJK coordinates of current element
            'vec4 ijkPos = uRASToIJK * vPos;',
            // shader rounding trick
            'ijkPos += .5;',

            //convert IJK coordinates to texture coordinates
            // 'if(int(floor(ijkPos[0])) >= 0',
            // '&& int(floor(ijkPos[1])) >= 0',
            // '&& int(floor(ijkPos[2])) >= 0',
            // '&& int(floor(ijkPos[0])) &lt; int(uIJKDims[0])',
            // '&& int(floor(ijkPos[1])) &lt; int(uIJKDims[1])',
            // '&& int(floor(ijkPos[2])) &lt; int(uIJKDims[2])',
            // '){',

            // show whole texture in the back...
            'vec3 color = vec3(0, 0, 0);',
            // try to map IJK to value...
            'vec3 ijkCoordinates = vec3(floor(ijkPos[0]), floor(ijkPos[1]), floor(ijkPos[2]));',
            'vec4 ijkValue = getIJKValue(t00, t01, t02, t03, ijkCoordinates, uIJKDims, uTextureSize);',
            'color.rgb = ijkValue.rgb;',
            'gl_FragColor = vec4(color, 1.0);',
            // '}',
            // 'else{',
            // //'discard;',
            // 'gl_FragColor = vec4(.47, .564, .611, 1.0);',
            // '}',

            '}'

        ].join('\n'),

        vertexShader: [

            'varying vec4 vPos;',

            //
            // main
            //
            'void main() {',

            'vPos = modelMatrix * vec4(position, 1.0 );',

            'gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );',

            '}'

        ].join('\n')

    }

};
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Wed May 13 2015 09:02:24 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
